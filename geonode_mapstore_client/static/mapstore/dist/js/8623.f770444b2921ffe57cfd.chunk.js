(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[8623],{957043:(e,t,r)=>{var i=r(862488),o=r(121078),n=r(200278),s=r(701469);e.exports=function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),r=arguments[0],a=e;a--;)t[a-1]=arguments[a];return i(s(r)?n(r):[r],o(t,1))}},701577:(e,t,r)=>{"use strict";r.d(t,{Z:()=>G});var i=r(949179),o=r(378426),n=r(919629),s=r(623068),a=r(30006),h=r(179682),u=r(690728),l=r(613002),_=r(9520),p=r(173381),d=r(436403),g=r(421915),c=r(28795),f=r(752043),y=r(938024),v=r(429902),m=r(973410),x=r(925753),F=r(273101),E=r(831219),C="modifyend",T=function(e){function t(t,r,i){e.call(this,t),this.features=r,this.mapBrowserEvent=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(_.ZP);function S(e,t){return e.index-t.index}function L(e,t){var r=t.geometry;if(r.getType()===c.Z.CIRCLE){var i=r;if(1===t.index){var o=(0,u.bI)(i.getCenter(),e),n=Math.sqrt(o)-i.getRadius();return n*n}}return(0,u.Bs)(e,t.segment)}function I(e,t){var r=t.geometry;return r.getType()===c.Z.CIRCLE&&1===t.index?r.getClosestPoint(e):(0,u.oL)(e,t.segment)}const G=function(e){function t(t){var r,i;if(e.call(this,t),this.condition_=t.condition?t.condition:d.Xp,this.defaultDeleteCondition_=function(e){return(0,d.Ko)(e)&&(0,d.Kf)(e)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:d.Bx,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new F.Z,this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new v.Z({source:new m.Z({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:(r=(0,E.createEditingStyle)(),function(e,t){return r[c.Z.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null,t.source?(this.source_=t.source,i=new o.Z(this.source_.getFeatures()),(0,l.oL)(this.source_,x.Z.ADDFEATURE,this.handleSourceAdd_,this),(0,l.oL)(this.source_,x.Z.REMOVEFEATURE,this.handleSourceRemove_,this)):i=t.features,!i)throw new Error("The modify interaction requires features or a source");this.features_=i,this.features_.forEach(this.addFeature_.bind(this)),(0,l.oL)(this.features_,n.Z.ADD,this.handleFeatureAdd_,this),(0,l.oL)(this.features_,n.Z.REMOVE,this.handleFeatureRemove_,this),this.lastPointerEvent_=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature_=function(e){var t=e.getGeometry();t&&t.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[t.getType()].call(this,e,t);var r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,r),(0,l.oL)(e,p.Z.CHANGE,this.handleFeatureChange_,this)},t.prototype.willModifyFeatures_=function(e){this.modified_||(this.modified_=!0,this.dispatchEvent(new T("modifystart",this.features_,e)))},t.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),(0,l.Ev)(e,p.Z.CHANGE,this.handleFeatureChange_,this)},t.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,r=[];t.forEach((function(t){e===t.feature&&r.push(t)}));for(var i=r.length-1;i>=0;--i)t.remove(r[i])},t.prototype.setActive=function(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.prototype.setActive.call(this,t)},t.prototype.setMap=function(t){this.overlay_.setMap(t),e.prototype.setMap.call(this,t)},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},t.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},t.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},t.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){var t=e.target;this.removeFeature_(t),this.addFeature_(t)}},t.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),i={feature:e,geometry:t,segment:[r,r]};this.rBush_.insert(t.getExtent(),i)},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i){var n=r[i],s={feature:e,geometry:t,depth:[i],index:i,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length-1;i<o;++i){var n=r.slice(i,i+2),s={feature:e,geometry:t,index:i,segment:n};this.rBush_.insert((0,g.hI)(n),s)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length-1;s<a;++s){var h=n.slice(s,s+2),u={feature:e,geometry:t,depth:[i],index:s,segment:h};this.rBush_.insert((0,g.hI)(h),u)}},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length-1;s<a;++s){var h=n.slice(s,s+2),u={feature:e,geometry:t,depth:[i],index:s,segment:h};this.rBush_.insert((0,g.hI)(h),u)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length;s<a;++s)for(var h=n[s],u=0,l=h.length-1;u<l;++u){var _=h.slice(u,u+2),p={feature:e,geometry:t,depth:[s,i],index:u,segment:_};this.rBush_.insert((0,g.hI)(_),p)}},t.prototype.writeCircleGeometry_=function(e,t){var r=t.getCenter(),i={feature:e,geometry:t,index:0,segment:[r,r]},o={feature:e,geometry:t,index:1,segment:[r,r]},n=[i,o];i.featureSegments=o.featureSegments=n,this.rBush_.insert((0,g.HK)(r),i),this.rBush_.insert(t.getExtent(),o)},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),i=0;i<r.length;++i)this.SEGMENT_WRITERS_[r[i].getType()].call(this,e,r[i])},t.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;return t?t.getGeometry().setCoordinates(e):(t=new s.Z(new f.Z(e)),this.vertexFeature_=t,this.overlay_.getSource().addFeature(t)),t},t.prototype.handleEvent=function(t){return!t.pointerEvent||(this.lastPointerEvent_=t,t.map.getView().getInteracting()||t.type!=a.Z.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(r=!(t.type!=a.Z.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==a.Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),e.prototype.handleEvent.call(this,t)&&!r);var r},t.prototype.handleDragEvent=function(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e);for(var t=e.coordinate,r=0,i=this.dragSegments_.length;r<i;++r){for(var o=this.dragSegments_[r],n=o[0],s=n.depth,a=n.geometry,h=void 0,l=n.segment,_=o[1];t.length<a.getStride();)t.push(l[_][t.length]);switch(a.getType()){case c.Z.POINT:h=t,l[0]=l[1]=t;break;case c.Z.MULTI_POINT:(h=a.getCoordinates())[n.index]=t,l[0]=l[1]=t;break;case c.Z.LINE_STRING:(h=a.getCoordinates())[n.index+_]=t,l[_]=t;break;case c.Z.MULTI_LINE_STRING:case c.Z.POLYGON:(h=a.getCoordinates())[s[0]][n.index+_]=t,l[_]=t;break;case c.Z.MULTI_POLYGON:(h=a.getCoordinates())[s[1]][s[0]][n.index+_]=t,l[_]=t;break;case c.Z.CIRCLE:l[0]=l[1]=t,0===n.index?(this.changingFeature_=!0,a.setCenter(t),this.changingFeature_=!1):(this.changingFeature_=!0,a.setRadius((0,u.TE)(a.getCenter(),t)),this.changingFeature_=!1)}h&&this.setGeometryCoordinates_(a,h)}this.createOrUpdateVertexFeature_(t)},t.prototype.handleDownEvent=function(e){if(!this.condition_(e))return!1;this.handlePointerAtPixel_(e.pixel,e.map);var t=e.map.getCoordinateFromPixel(e.pixel);this.dragSegments_.length=0,this.modified_=!1;var r=this.vertexFeature_;if(r){var o=[],n=r.getGeometry().getCoordinates(),s=(0,g.hI)([n]),a=this.rBush_.getInExtent(s),h={};a.sort(S);for(var l=0,_=a.length;l<_;++l){var p=a[l],d=p.segment,f=(0,i.sq)(p.feature),y=p.depth;if(y&&(f+="-"+y.join("-")),h[f]||(h[f]=new Array(2)),p.geometry.getType()===c.Z.CIRCLE&&1===p.index){var v=I(t,p);(0,u.fS)(v,n)&&!h[f][0]&&(this.dragSegments_.push([p,0]),h[f][0]=p)}else if((0,u.fS)(d[0],n)&&!h[f][0])this.dragSegments_.push([p,0]),h[f][0]=p;else if((0,u.fS)(d[1],n)&&!h[f][1]){if((p.geometry.getType()===c.Z.LINE_STRING||p.geometry.getType()===c.Z.MULTI_LINE_STRING)&&h[f][0]&&0===h[f][0].index)continue;this.dragSegments_.push([p,1]),h[f][1]=p}else this.insertVertexCondition_(e)&&(0,i.sq)(d)in this.vertexSegments_&&!h[f][0]&&!h[f][1]&&o.push([p,n])}o.length&&this.willModifyFeatures_(e);for(var m=o.length-1;m>=0;--m)this.insertVertex_.apply(this,o[m])}return!!this.vertexFeature_},t.prototype.handleUpEvent=function(e){for(var t=this.dragSegments_.length-1;t>=0;--t){var r=this.dragSegments_[t][0],i=r.geometry;if(i.getType()===c.Z.CIRCLE){var o=i.getCenter(),n=r.featureSegments[0],s=r.featureSegments[1];n.segment[0]=n.segment[1]=o,s.segment[0]=s.segment[1]=o,this.rBush_.update((0,g.HK)(o),n),this.rBush_.update(i.getExtent(),s)}else this.rBush_.update((0,g.hI)(r.segment),r)}return this.modified_&&(this.dispatchEvent(new T(C,this.features_,e)),this.modified_=!1),!1},t.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map)},t.prototype.handlePointerAtPixel_=function(e,t){var r=t.getCoordinateFromPixel(e),o=(0,g.f3)((0,g.HK)(r),t.getView().getResolution()*this.pixelTolerance_),n=this.rBush_.getInExtent(o);if(n.length>0){n.sort((function(e,t){return L(r,e)-L(r,t)}));var s=n[0],a=s.segment,h=I(r,s),l=t.getPixelFromCoordinate(h),_=(0,u.TE)(e,l);if(_<=this.pixelTolerance_){var p={};if(s.geometry.getType()===c.Z.CIRCLE&&1===s.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h);else{var d=t.getPixelFromCoordinate(a[0]),f=t.getPixelFromCoordinate(a[1]),y=(0,u.bI)(l,d),v=(0,u.bI)(l,f);_=Math.sqrt(Math.min(y,v)),this.snappedToVertex_=_<=this.pixelTolerance_,this.snappedToVertex_&&(h=y>v?a[1]:a[0]),this.createOrUpdateVertexFeature_(h);for(var m=1,x=n.length;m<x;++m){var F=n[m].segment;if(!((0,u.fS)(a[0],F[0])&&(0,u.fS)(a[1],F[1])||(0,u.fS)(a[0],F[1])&&(0,u.fS)(a[1],F[0])))break;p[(0,i.sq)(F)]=!0}}return p[(0,i.sq)(a)]=!0,void(this.vertexSegments_=p)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},t.prototype.insertVertex_=function(e,t){for(var r,i=e.segment,o=e.feature,n=e.geometry,s=e.depth,a=e.index;t.length<n.getStride();)t.push(0);switch(n.getType()){case c.Z.MULTI_LINE_STRING:case c.Z.POLYGON:(r=n.getCoordinates())[s[0]].splice(a+1,0,t);break;case c.Z.MULTI_POLYGON:(r=n.getCoordinates())[s[1]][s[0]].splice(a+1,0,t);break;case c.Z.LINE_STRING:(r=n.getCoordinates()).splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(n,r);var h=this.rBush_;h.remove(e),this.updateSegmentIndices_(n,a,s,1);var u={segment:[i[0],t],feature:o,geometry:n,depth:s,index:a};h.insert((0,g.hI)(u.segment),u),this.dragSegments_.push([u,1]);var l={segment:[t,i[1]],feature:o,geometry:n,depth:s,index:a+1};h.insert((0,g.hI)(l.segment),l),this.dragSegments_.push([l,0]),this.ignoreNextSingleClick_=!0},t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=a.Z.POINTERDRAG){var e=this.lastPointerEvent_;return this.willModifyFeatures_(e),this.removeVertex_(),this.dispatchEvent(new T(C,this.features_,e)),this.modified_=!1,!0}return!1},t.prototype.removeVertex_=function(){var e,t,r,o,n,s,a,h,u,l,_,p=this.dragSegments_,d={},f=!1;for(n=p.length-1;n>=0;--n)l=(r=p[n])[0],_=(0,i.sq)(l.feature),l.depth&&(_+="-"+l.depth.join("-")),_ in d||(d[_]={}),0===r[1]?(d[_].right=l,d[_].index=l.index):1==r[1]&&(d[_].left=l,d[_].index=l.index+1);for(_ in d){switch(u=d[_].right,a=d[_].left,(h=(s=d[_].index)-1)<0&&(h=0),e=t=(o=(l=void 0!==a?a:u).geometry).getCoordinates(),f=!1,o.getType()){case c.Z.MULTI_LINE_STRING:t[l.depth[0]].length>2&&(t[l.depth[0]].splice(s,1),f=!0);break;case c.Z.LINE_STRING:t.length>2&&(t.splice(s,1),f=!0);break;case c.Z.MULTI_POLYGON:e=e[l.depth[1]];case c.Z.POLYGON:(e=e[l.depth[0]]).length>4&&(s==e.length-1&&(s=0),e.splice(s,1),f=!0,0===s&&(e.pop(),e.push(e[0]),h=e.length-1))}if(f){this.setGeometryCoordinates_(o,t);var y=[];if(void 0!==a&&(this.rBush_.remove(a),y.push(a.segment[0])),void 0!==u&&(this.rBush_.remove(u),y.push(u.segment[1])),void 0!==a&&void 0!==u){var v={depth:l.depth,feature:l.feature,geometry:l.geometry,index:h,segment:y};this.rBush_.insert((0,g.hI)(v.segment),v)}this.updateSegmentIndices_(o,s,l.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),p.length=0}}return f},t.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1},t.prototype.updateSegmentIndices_=function(e,t,r,i){this.rBush_.forEachInExtent(e.getExtent(),(function(o){o.geometry===e&&(void 0===r||void 0===o.depth||(0,h.fS)(o.depth,r))&&o.index>t&&(o.index+=i)}))},t}(y.Z)},51273:(e,t,r)=>{"use strict";r.d(t,{Z:()=>v});var i=r(949179),o=r(919629),n=r(179682),s=r(613002),a=r(9520),h=r(436403),u=r(864011),l=r(28795),_=r(247588),p=r(429902),d=r(913580),g=r(973410),c=r(831219),f=function(e){function t(t,r,i,o){e.call(this,t),this.selected=r,this.deselected=i,this.mapBrowserEvent=o}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(a.ZP);function y(e){if(!this.condition_(e))return!0;var t=this.addCondition_(e),r=this.removeCondition_(e),i=this.toggleCondition_(e),o=!t&&!r&&!i,s=e.map,a=this.getFeatures(),u=[],l=[];if(o){(0,d.ZH)(this.featureLayerAssociation_),s.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t))return l.push(e),this.addFeatureLayerAssociation_(e,t),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var _=a.getLength()-1;_>=0;--_){var p=a.item(_),g=l.indexOf(p);g>-1?l.splice(g,1):(a.remove(p),u.push(p))}0!==l.length&&a.extend(l)}else{s.forEachFeatureAtPixel(e.pixel,function(e,o){if(this.filter_(e,o))return!t&&!i||(0,n.q9)(a.getArray(),e)?(r||i)&&(0,n.q9)(a.getArray(),e)&&(u.push(e),this.removeFeatureLayerAssociation_(e)):(l.push(e),this.addFeatureLayerAssociation_(e,o)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var c=u.length-1;c>=0;--c)a.remove(u[c]);a.extend(l)}return(l.length>0||u.length>0)&&this.dispatchEvent(new f("select",l,u,e)),(0,h.MJ)(e)}const v=function(e){function t(t){e.call(this,{handleEvent:y});var r=t||{};this.condition_=r.condition?r.condition:h.Kf,this.addCondition_=r.addCondition?r.addCondition:h.Fi,this.removeCondition_=r.removeCondition?r.removeCondition:h.Fi,this.toggleCondition_=r.toggleCondition?r.toggleCondition:h.vY,this.multi_=!!r.multi&&r.multi,this.filter_=r.filter?r.filter:u.uX,this.hitTolerance_=r.hitTolerance?r.hitTolerance:0;var i,a,_=new p.Z({source:new g.Z({useSpatialIndex:!1,features:r.features,wrapX:r.wrapX}),style:r.style?r.style:(a=(0,c.createEditingStyle)(),(0,n.l7)(a[l.Z.POLYGON],a[l.Z.LINE_STRING]),(0,n.l7)(a[l.Z.GEOMETRY_COLLECTION],a[l.Z.LINE_STRING]),function(e,t){return e.getGeometry()?a[e.getGeometry().getType()]:null}),updateWhileAnimating:!0,updateWhileInteracting:!0});if(this.featureOverlay_=_,r.layers)if("function"==typeof r.layers)i=r.layers;else{var d=r.layers;i=function(e){return(0,n.q9)(d,e)}}else i=u.uX;this.layerFilter_=i,this.featureLayerAssociation_={};var f=this.getFeatures();(0,s.oL)(f,o.Z.ADD,this.addFeature_,this),(0,s.oL)(f,o.Z.REMOVE,this.removeFeature_,this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeatureLayerAssociation_=function(e,t){this.featureLayerAssociation_[(0,i.sq)(e)]=t},t.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.getLayer=function(e){return this.featureLayerAssociation_[(0,i.sq)(e)]},t.prototype.getOverlay=function(){return this.featureOverlay_},t.prototype.setHitTolerance=function(e){this.hitTolerance_=e},t.prototype.setMap=function(t){var r=this.getMap(),i=this.getFeatures();r&&i.forEach(r.unskipFeature.bind(r)),e.prototype.setMap.call(this,t),this.featureOverlay_.setMap(t),t&&i.forEach(t.skipFeature.bind(t))},t.prototype.addFeature_=function(e){var t=this.getMap();t&&t.skipFeature(e.element)},t.prototype.removeFeature_=function(e){var t=this.getMap();t&&t.unskipFeature(e.element)},t.prototype.removeFeatureLayerAssociation_=function(e){delete this.featureLayerAssociation_[(0,i.sq)(e)]},t}(_.ZP)},650141:(e,t,r)=>{"use strict";r.d(t,{Z:()=>v});var i=r(949179),o=r(919629),n=r(690728),s=r(613002),a=r(173381),h=r(421915),u=r(864011),l=r(28795),_=r(640353),p=r(938024),d=r(913580),g=r(925753),c=r(273101);function f(e){return e.feature?e.feature:e.element?e.element:void 0}function y(e,t){return(0,n.Bs)(this.pixelCoordinate_,e.segment)-(0,n.Bs)(this.pixelCoordinate_,t.segment)}const v=function(e){function t(t){var r=t||{},i=r;i.handleDownEvent||(i.handleDownEvent=u.uX),i.stopDown||(i.stopDown=u.Dv),e.call(this,i),this.source_=r.source?r.source:null,this.vertex_=void 0===r.vertex||r.vertex,this.edge_=void 0===r.edge||r.edge,this.features_=r.features?r.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelCoordinate_=null,this.pixelTolerance_=void 0!==r.pixelTolerance?r.pixelTolerance:10,this.sortByDistance_=y.bind(this),this.rBush_=new c.Z,this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e,t){var r=void 0===t||t,o=(0,i.sq)(e),n=e.getGeometry();if(n){var u=this.SEGMENT_WRITERS_[n.getType()];u&&(this.indexedFeaturesExtents_[o]=n.getExtent((0,h.lJ)()),u.call(this,e,n))}r&&(this.featureChangeListenerKeys_[o]=(0,s.oL)(e,a.Z.CHANGE,this.handleFeatureChange_,this))},t.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)},t.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)},t.prototype.getFeatures_=function(){var e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e},t.prototype.handleEvent=function(t){var r=this.snapTo(t.pixel,t.coordinate,t.map);return r.snapped&&(t.coordinate=r.vertex.slice(0,2),t.pixel=r.vertexPixel),e.prototype.handleEvent.call(this,t)},t.prototype.handleFeatureAdd_=function(e){var t=f(e);this.addFeature(t)},t.prototype.handleFeatureRemove_=function(e){var t=f(e);this.removeFeature(t)},t.prototype.handleFeatureChange_=function(e){var t=e.target;if(this.handlingDownUpSequence){var r=(0,i.sq)(t);r in this.pendingFeatures_||(this.pendingFeatures_[r]=t)}else this.updateFeature_(t)},t.prototype.handleUpEvent=function(e){var t=(0,d.KX)(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},t.prototype.removeFeature=function(e,t){var r=void 0===t||t,o=(0,i.sq)(e),n=this.indexedFeaturesExtents_[o];if(n){var a=this.rBush_,h=[];a.forEachInExtent(n,(function(t){e===t.feature&&h.push(t)}));for(var u=h.length-1;u>=0;--u)a.remove(h[u])}r&&((0,s.bN)(this.featureChangeListenerKeys_[o]),delete this.featureChangeListenerKeys_[o])},t.prototype.setMap=function(t){var r=this.getMap(),i=this.featuresListenerKeys_,n=this.getFeatures_();r&&(i.forEach(s.bN),i.length=0,n.forEach(this.forEachFeatureRemove_.bind(this))),e.prototype.setMap.call(this,t),t&&(this.features_?i.push((0,s.oL)(this.features_,o.Z.ADD,this.handleFeatureAdd_,this),(0,s.oL)(this.features_,o.Z.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push((0,s.oL)(this.source_,g.Z.ADDFEATURE,this.handleFeatureAdd_,this),(0,s.oL)(this.source_,g.Z.REMOVEFEATURE,this.handleFeatureRemove_,this)),n.forEach(this.forEachFeatureAdd_.bind(this)))},t.prototype.snapTo=function(e,t,r){var i=r.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),o=r.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),s=(0,h.hI)([i,o]),a=this.rBush_.getInExtent(s);this.vertex_&&!this.edge_&&(a=a.filter((function(e){return e.feature.getGeometry().getType()!==l.Z.CIRCLE})));var u,_,p,d,g=!1,c=null,f=null;if(a.length>0){this.pixelCoordinate_=t,a.sort(this.sortByDistance_);var y=a[0].segment,v=a[0].feature.getGeometry().getType()===l.Z.CIRCLE;this.vertex_&&!this.edge_?(u=r.getPixelFromCoordinate(y[0]),_=r.getPixelFromCoordinate(y[1]),p=(0,n.bI)(e,u),d=(0,n.bI)(e,_),Math.sqrt(Math.min(p,d))<=this.pixelTolerance_&&(g=!0,c=p>d?y[1]:y[0],f=r.getPixelFromCoordinate(c))):this.edge_&&(c=v?(0,n.Ed)(t,a[0].feature.getGeometry()):(0,n.oL)(t,y),f=r.getPixelFromCoordinate(c),(0,n.TE)(e,f)<=this.pixelTolerance_&&(g=!0,this.vertex_&&!v&&(u=r.getPixelFromCoordinate(y[0]),_=r.getPixelFromCoordinate(y[1]),p=(0,n.bI)(f,u),d=(0,n.bI)(f,_),Math.sqrt(Math.min(p,d))<=this.pixelTolerance_&&(c=p>d?y[1]:y[0],f=r.getPixelFromCoordinate(c))))),g&&(f=[Math.round(f[0]),Math.round(f[1])])}return{snapped:g,vertex:c,vertexPixel:f}},t.prototype.updateFeature_=function(e){this.removeFeature(e,!1),this.addFeature(e,!1)},t.prototype.writeCircleGeometry_=function(e,t){for(var r=(0,_.Bb)(t).getCoordinates()[0],i=0,o=r.length-1;i<o;++i){var n=r.slice(i,i+2),s={feature:e,segment:n};this.rBush_.insert((0,h.hI)(n),s)}},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),i=0;i<r.length;++i){var o=this.SEGMENT_WRITERS_[r[i].getType()];o&&o.call(this,e,r[i])}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length-1;i<o;++i){var n=r.slice(i,i+2),s={feature:e,segment:n};this.rBush_.insert((0,h.hI)(n),s)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length-1;s<a;++s){var u=n.slice(s,s+2),l={feature:e,segment:u};this.rBush_.insert((0,h.hI)(u),l)}},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i){var n=r[i],s={feature:e,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length;s<a;++s)for(var u=n[s],l=0,_=u.length-1;l<_;++l){var p=u.slice(l,l+2),d={feature:e,segment:p};this.rBush_.insert((0,h.hI)(p),d)}},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),i={feature:e,segment:[r,r]};this.rBush_.insert(t.getExtent(),i)},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length-1;s<a;++s){var u=n.slice(s,s+2),l={feature:e,segment:u};this.rBush_.insert((0,h.hI)(u),l)}},t}(p.Z)},829194:(e,t,r)=>{"use strict";r.d(t,{Z:()=>p});var i=r(378426),o=r(558493),n=r(613002),s=r(9520),a=r(864011),h=r(179682),u=r(938024),l=r(173604),_=function(e){function t(t,r,i){e.call(this,t),this.features=r,this.coordinate=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(s.ZP);const p=function(e){function t(t){var r,i=t||{};if(e.call(this,i),this.lastCoordinate_=null,this.features_=void 0!==i.features?i.features:null,i.layers)if("function"==typeof i.layers)r=i.layers;else{var s=i.layers;r=function(e){return(0,h.q9)(s,e)}}else r=a.uX;this.layerFilter_=r,this.hitTolerance_=i.hitTolerance?i.hitTolerance:0,this.lastFeature_=null,(0,n.oL)(this,(0,o.v_)(l.Z.ACTIVE),this.handleActiveChanged_,this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.handleDownEvent=function(e){if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);var t=this.features_||new i.Z([this.lastFeature_]);return this.dispatchEvent(new _("translatestart",t,e.coordinate)),!0}return!1},t.prototype.handleUpEvent=function(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);var t=this.features_||new i.Z([this.lastFeature_]);return this.dispatchEvent(new _("translateend",t,e.coordinate)),!0}return!1},t.prototype.handleDragEvent=function(e){if(this.lastCoordinate_){var t=e.coordinate,r=t[0]-this.lastCoordinate_[0],o=t[1]-this.lastCoordinate_[1],n=this.features_||new i.Z([this.lastFeature_]);n.forEach((function(e){var t=e.getGeometry();t.translate(r,o),e.setGeometry(t)})),this.lastCoordinate_=t,this.dispatchEvent(new _("translating",n,t))}},t.prototype.handleMoveEvent=function(e){var t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")},t.prototype.featuresAtPixel_=function(e,t){return t.forEachFeatureAtPixel(e,function(e){if(!this.features_||(0,h.q9)(this.features_.getArray(),e))return e}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.setHitTolerance=function(e){this.hitTolerance_=e},t.prototype.setMap=function(t){var r=this.getMap();e.prototype.setMap.call(this,t),this.updateState_(r)},t.prototype.handleActiveChanged_=function(){this.updateState_(null)},t.prototype.updateState_=function(e){var t=this.getMap(),r=this.getActive();t&&r||(t=t||e)&&t.getViewport().classList.remove("ol-grab","ol-grabbing")},t}(u.Z)}}]);