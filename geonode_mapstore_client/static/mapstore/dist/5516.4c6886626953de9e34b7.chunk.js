(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[5516],{89912:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var o,n=r(24852),a=r(43033);const i=function(e){var t=e.map,r=e.onBoxEnd,i=e.status;return(0,n.useEffect)((function(){"start"===i?(o=new a.Z({condition:function(e){return e.originalEvent.altKey}}),t.addInteraction(o)):"end"===i&&t.removeInteraction(o)}),[i]),(0,n.useEffect)((function(){o&&o.on("boxend",(function(e){r({boxExtent:o.getGeometry().getExtent(),modifiers:{ctrl:e.mapBrowserEvent.pointerEvent.ctrlKey,metaKey:e.mapBrowserEvent.pointerEvent.metaKey}})}))}),[i]),null}},6909:(e,t,r)=>{"use strict";r.d(t,{Z:()=>Ge});var o=r(24852),n=r.n(o),a=r(57043),i=r.n(a),s=r(91175),c=r.n(s),p=r(13311),u=r.n(p),l=r(12571),d=r.n(l),f=r(57557),y=r.n(f),g=r(1469),m=r.n(g),w=r(10928),v=r.n(w),C=r(63105),h=r.n(C),P=r(14293),b=r.n(P),S=r(84596),G=r.n(S),F=r(45697),O=r.n(F),I=r(27418),E=r.n(I),T=r(55877),j=r.n(T),x=r(9669),M=r.n(x),k=r(52259),L=r(86267),D=r(66287),Z=r(64250),A=r(58767),W=r(93546),R=r(69141),_=r(23068),N=r(97016),B=r(29902),J=r(72445),H=r(52329),V=r(40353),K=r(52043),U=r(44538),q=r(25642),z=r(13987),X=r(69669),$=r(98090),Q=r(31219),Y=r(98185),ee=r(20767),te=r(15565),re=r(9371),oe=r(78426),ne=r(36403),ae=r(18369),ie=r(29194),se=r(1577),ce=r(51273),pe=r(56834),ue=r(21915);function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}function de(e){return function(e){if(Array.isArray(e))return fe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return fe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?fe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(r),!0).forEach((function(t){be(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ve(e,t){return ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ve(e,t)}function Ce(e,t){if(t&&("object"===le(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return he(e)}function he(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pe(e){return Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Pe(e)}function be(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Se=new R.Z,Ge=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ve(e,t)}(s,e);var t,r,o,n,a=(o=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Pe(o);if(n){var r=Pe(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ce(this,e)});function s(){var e;me(this,s);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return be(he(e=a.call.apply(a,[this].concat(r))),"getNewFeature",(function(t,r,o,n){return new _.Z({geometry:e.createOLGeometry({type:t,coordinates:r,radius:o,center:n})})})),be(he(e),"getMapCrs",(function(){return e.props.map.getView().getProjection().getCode()})),be(he(e),"updateFeatureStyles",(function(t){t&&t.length>0&&t.forEach((function(t){if(t.style){var r=e.toOlFeature(t);r&&r.setStyle(t.style?(0,W.C2)(t):e.toOlStyle(t.style,t.selected))}}))})),be(he(e),"updateOnlyFeatureStyles",(function(t){e.drawLayer&&e.drawLayer.getSource().getFeatures().forEach((function(e){var r=c()(t.features).features||t.features,o=u()(r,(function(t){return t.properties.id===e.getProperties().id}));if(o){var n=(0,D.createStylesAsync)(G()(o.style));M().all(n).then((function(t){e.setStyle((function(){return(0,W.Cw)(ge(ge({},o),{},{style:t}))}))}))}}))})),be(he(e),"addLayer",(function(t,r){var o,n=e.convertGeometryTypeToStyleType(t.drawMethod);o=function(e){var r=c()(t.features)&&u()(c()(t.features).features,(function(t){return t.properties.id===e.getProperties().id}))||null;if(r){var o=(0,D.createStylesAsync)(G()(r.style));return M().all(o).then((function(t){e.setStyle((function(){return(0,W.Cw)(ge(ge({},r),{},{style:t}))}))})),null}return(0,W.Cw)({style:W.jF[n]})},e.geojson=new R.Z,e.drawSource=new N.Z,e.drawLayer=new B.Z({source:e.drawSource,zIndex:1e8,style:o}),e.props.map.addLayer(e.drawLayer),r&&e.addInteractions(t);var a=c()(t.features);if(a&&a.features&&a.features.length){var i=a.features.filter((function(e){return!e.properties.isCircle||e.properties.isCircle&&!e.properties.canEdit||!t.options.drawEnabled}));return e.addFeatures(E()({},t,{features:[ge(ge({},a),{},{features:i})]}))}return e.addFeatures(t)})),be(he(e),"addFeatures",(function(t){var r,o=t.features,n=t.drawMethod,a=t.options,i=e.getMapCrs();if(o.forEach((function(t){if("FeatureCollection"===t.type){var o=(new R.Z).readFeatures(t);a.geodesic||(o=o.map((function(e){return(0,Z.a)(e,i)}))),e.drawSource=new N.Z({features:o}),e.drawLayer.setSource(e.drawSource)}else{var s,c=null,p=t;if(p.geometry&&"GeometryCollection"!==p.geometry.type&&(p=(0,L.reprojectGeoJson)(p,p.featureProjection,i).geometry),"GeometryCollection"!==p.type)"Circle"===n&&p&&(p.properties&&p.properties.center||p.center)?(c=[(c=p.properties&&p.properties.center?(0,L.reproject)(p.properties.center,"EPSG:4326",i):p.center).x,c.y],r=new _.Z({geometry:e.createOLGeometry({type:"Circle",center:c,projection:"EPSG:3857",radius:p.properties&&p.properties.radius||p.radius,options:a})})):r=new _.Z({geometry:e.createOLGeometry(p.geometry?p.geometry:ge(ge({},p),{},{radius:null===(s=p.properties)||void 0===s?void 0:s.radius,center:c}))}),r.setProperties(t.properties),e.drawSource.addFeature(r)}})),0===o.length&&(a.editEnabled||a.drawEnabled))a.transformToFeatureCollection?(e.drawSource=new N.Z({features:(new R.Z).readFeatures({type:"FeatureCollection",features:[]})}),e.drawLayer.setSource(e.drawSource)):(r=new _.Z({geometry:e.createOLGeometry({type:n,coordinates:null})}),e.drawSource.addFeature(r));else{if(o[0]&&"GeometryCollection"===o[0].type){e.drawSource=new N.Z({features:(new R.Z).readFeatures(o[0])});var s=e.replacePolygonsWithCircles(e.drawSource.getFeatures()[0]);e.drawSource.getFeatures()[0].getGeometry().setGeometries(s),e.drawLayer.setSource(e.drawSource)}o[0]&&o[0].geometry&&"GeometryCollection"===o[0].geometry.type&&(r=(0,L.reprojectGeoJson)(o[0],a.featureProjection,i).geometry,e.drawSource=new N.Z({features:(new R.Z).readFeatures(r)}),e.drawSource.getFeatures()[0].set("textGeometriesIndexes",o[0].properties&&o[0].properties.textGeometriesIndexes),e.drawSource.getFeatures()[0].set("textValues",o[0].properties&&o[0].properties.textValues),e.drawSource.getFeatures()[0].set("circles",o[0].properties&&o[0].properties.circles),e.drawLayer.setSource(e.drawSource))}return e.updateFeatureStyles(o),r})),be(he(e),"replaceFeatures",(function(t){var r;return e.drawLayer?(e.drawSource.clear(),r=e.addFeatures(t),t.style&&e.drawLayer.setStyle((function(r){var o=u()(c()(t.features).features,(function(e){return e.properties.id===r.getProperties().id}));if(o){var n=(0,D.createStylesAsync)(G()(o.style));return M().all(n).then((function(e){r.setStyle((function(){return(0,W.Cw)(ge(ge({},o),{},{style:e}))}))})),null}var a=e.convertGeometryTypeToStyleType(t.drawMethod);return(0,W.Cw)({style:W.jF[a]})}))):r=e.addLayer(t,t.options&&t.options.drawEnabled||!1),r})),be(he(e),"endDrawing",(function(t){var r=e.replaceFeatures(t);if(r){var o=e.fromOLFeature(r);"Circle"===t.drawMethod&&t&&t.features&&t.features.length&&t.features[0]&&t.features[0].radius>=0&&(o.radius=t.features[0].radius),e.props.onEndDrawing(o,t.drawOwner)}})),be(he(e),"addDrawInteraction",(function(t,r,o,n){e.drawInteraction&&e.removeDrawInteraction(),e.drawInteraction=new J.ZP(e.drawPropertiesForGeometryType(t,o,e.drawSource,n)),e.props.map.disableEventListener("singleclick"),e.drawInteraction.on("drawstart",(function(){e.selectInteraction&&(e.selectInteraction.getFeatures().clear(),e.selectInteraction.setActive(!1))})),e.drawInteraction.on("drawend",(function(t){var o=t.feature.clone();if(o.set("id",j().v1()),"Circle"===e.props.drawMethod&&"Circle"===o.getGeometry().getType()){var n=o.getGeometry().getRadius(),a=o.getGeometry().getCenter();o.setGeometry(e.polygonFromCircle(a,n))}var i=e.fromOLFeature(o,r);e.props.onEndDrawing(i,e.props.drawOwner),e.props.options.stopAfterDrawing&&e.props.onChangeDrawingStatus("stop",e.props.drawMethod,e.props.drawOwner,e.props.features.concat([i])),e.selectInteraction&&(e.addSelectInteraction(),e.selectInteraction.setActive(!0))})),e.props.map.addInteraction(e.drawInteraction),e.setDoubleClickZoomEnabled(!1)})),be(he(e),"toMulti",(function(e){return"Point"===e.getType()?new H.Z([e.getCoordinates()]):e})),be(he(e),"handleDrawAndEdit",(function(t,r,o,n){e.drawInteraction&&e.removeDrawInteraction(),e.drawInteraction=new J.ZP(e.drawPropertiesForGeometryType((0,k.getSimpleGeomType)(t),o,(0,k.isSimpleGeomType)(t)?e.drawSource:null,n)),e.props.map.disableEventListener("singleclick"),e.drawInteraction.on("drawstart",(function(){e.selectInteraction&&(e.selectInteraction.getFeatures().clear(),e.selectInteraction.setActive(!1))})),e.drawInteraction.on("drawend",(function(o){var a=o.feature.clone(),i=j().v1();a.set("id",i);var s,p,l,d=a.getGeometry(),f=e.drawLayer.getSource().getFeatures(),y=e.props.features;if(e.props.options.transformToFeatureCollection){var g;if("Circle"===t){var m,w,C;if(l="Polygon",e.props.options.geodesic){w=o.feature.getGeometry().geodesicCenter||(0,ue.qg)(d.getExtent());var h=e.props.map.getView().getProjection().getCode(),P=[de(w),de(d.getCoordinates()[0][0])].map((function(t){return e.reprojectCoordinatesToWGS84(t,h)}));m=(0,L.calculateDistance)(P,"haversine"),C=(0,V.iu)(P[0],m).clone().transform("EPSG:4326",h).getCoordinates()}else m=d.getRadius(),w=d.getCenter(),C=e.polygonCoordsFromCircle(w,m);g=e.getNewFeature(l,C),w=(0,L.reproject)(w,e.getMapCrs(),"EPSG:4326",!1);var b=n&&n.features&&n.features.length&&n.features[0]&&n.features[0].features&&n.features[0].features.length&&n.features[0].features.filter((function(e){return e.properties.isDrawing}))[0].properties.id||i;g.setProperties({isCircle:!0,radius:m,center:[w.x,w.y],id:b,crs:e.getMapCrs(),isGeodesic:e.props.options.geodesic})}else if("Polygon"===t){l=e.props.drawMethod;var S=d.getCoordinates();S[0].push(S[0][0]),g=e.getNewFeature(l,S)}else{l="Text"===t?"Point":e.props.drawMethod;var G=d.getCoordinates();g=e.getNewFeature(l,G),"Text"===t&&g.setProperties({isText:!0,valueText:"."})}var F=f.length>=1?de(e.replaceCirclesWithPolygonsInFeatureColl(f)):[];g.getProperties().id||g.setProperties({id:j().v1()});var O=[].concat(de(F),[g]),I=Se.writeFeaturesObject(O),T=new N.Z({features:(new R.Z).readFeatures(I)});e.drawLayer.setSource(T);var x=(0,L.reprojectGeoJson)(I,e.getMapCrs(),"EPSG:4326");e.props.onGeometryChanged([x],e.props.drawOwner,e.props.options&&e.props.options.stopAfterDrawing?"enterEditMode":"","Text"===t,"Circle"===t),e.props.onEndDrawing(x,e.props.drawOwner),e.props.onDrawingFeatures([v()(x.features)])}else{if("Circle"===t){l="Polygon";var M=d.getRadius(),D=d.getCenter(),Z=e.polygonCoordsFromCircle(D,M),A=e.toMulti(e.createOLGeometry({type:l,coordinates:Z}));if(1===y.length&&y[0]&&!y[0].geometry)s=[],p=new $.default([A]);else if((s=e.toMulti(c()(f).getGeometry())).getGeometries){var W=e.replaceCirclesWithPolygons(c()(f));p=new $.default([].concat(de(W),[A]))}else p=new $.default([s,A]);a.setGeometry(p)}else if("Text"===t||"MultiPoint"===t){var _=d.getCoordinates();l="MultiPoint";var B=e.toMulti(e.createOLGeometry({type:l,coordinates:[_]}));if(1!==y.length||y[0].geometry)if((s=e.toMulti(c()(f).getGeometry())).getGeometries){var J=e.replaceCirclesWithPolygons(c()(f));p=new $.default([].concat(de(J),[B]))}else(p=s.clone()).appendPoint(B.getPoint(0));else s=[],p=B.clone();a.setGeometry(p)}else if(!(0,k.isSimpleGeomType)(t)){var H;p=null,s=1!==y.length||y[0].geometry?e.toMulti(c()(f).getGeometry()):e.toMulti(e.createOLGeometry({type:t,coordinates:null}));var K=f.map((function(e){return"GeometryCollection"===e.getGeometry().getType()?e.getGeometry().getGeometries():e.getGeometry()}));"GeometryCollection"===f[0].getGeometry().getType()&&(K=K[0]);var U=u()(K,(function(e){return e.getType()===t}));if(U?e.appendToMultiGeometry(t,U,d):H=e.toMulti(e.createOLGeometry({type:t,coordinates:d.getCoordinates()})),d.getType()!==(0,k.getSimpleGeomType)(s.getType())){var q=c()(f).getGeometry().getGeometries?e.replaceCirclesWithPolygons(c()(f)):[];if(U){var z=q.map((function(e){return e.getType()===U.getType()?U:e}));p=new $.default(z)}else p="GeometryCollection"===s.getType()?new $.default([].concat(de(q),[H])):"Text"===t?new $.default([H]):new $.default([s,H]);a.setGeometry(p)}else a.setGeometry(U)}var X=e.props.features[0].properties;"Text"===t&&(X=E()({},e.props.features[0].properties,{textValues:(e.props.features[0].properties.textValues||[]).concat(["."]),textGeometriesIndexes:(e.props.features[0].properties.textGeometriesIndexes||[]).concat([a.getGeometry().getGeometries().length-1])})),"Circle"===t&&(X=E()({},X,{circles:(e.props.features[0].properties.circles||[]).concat([a.getGeometry().getGeometries().length-1])}));var Q=e.fromOLFeature(a,r,X),Y=new N.Z({features:(new R.Z).readFeatures(Q)});e.drawLayer.setSource(Y);var ee=(0,L.reprojectGeoJson)(Se.writeFeatureObject(a.clone()),e.getMapCrs(),"EPSG:4326");"Polygon"===ee.geometry.type&&ee.geometry.coordinates[0].push(ee.geometry.coordinates[0][0]),e.props.onGeometryChanged([ee],e.props.drawOwner,e.props.options&&e.props.options.stopAfterDrawing?"enterEditMode":"","Text"===t,"Circle"===t),e.props.onEndDrawing(Q,e.props.drawOwner),Q=(0,L.reprojectGeoJson)(Q,e.getMapCrs(),"EPSG:4326");var te=(0,k.isSimpleGeomType)(e.props.drawMethod)&&"GeometryCollection"!==e.props.features[0].geometry.type?e.props.features.map((function(t){return ge(ge({},t),{},{featureProjection:e.getMapCrs()})})).concat([ge(ge({},Q),{},{type:"Feature",geometry:{type:Q.type,coordinates:Q.coordinates},featureProjection:e.getMapCrs(),properties:X})]):[ge(ge({},Q),{},{properties:X})];e.props.options.stopAfterDrawing?e.props.onChangeDrawingStatus("stop",e.props.drawMethod,e.props.drawOwner,te):e.props.onChangeDrawingStatus("replace",e.props.drawMethod,e.props.drawOwner,te.map((function(t){return(0,L.reprojectGeoJson)(t,"EPSG:4326",e.getMapCrs())})),E()({},e.props.options,{featureProjection:e.getMapCrs()})),e.selectInteraction&&(e.addSelectInteraction(),e.selectInteraction.setActive(!0))}})),e.props.map.addInteraction(e.drawInteraction),e.setDoubleClickZoomEnabled(!1)})),be(he(e),"drawPropertiesForGeometryType",(function(t,r,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a={source:e.drawSource||o,type:t,style:"Marker"===t?(0,W.Fc)(n.style):new Q.default({fill:new Y.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ee.default({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new re.default({radius:5,stroke:new ee.default({color:"rgba(0, 0, 0, 0.7)"}),fill:new Y.default({color:"rgba(255, 255, 255, 0.2)"})})}),features:new oe.Z,condition:ne.Bx},i={};switch(t){case"BBOX":i.type="LineString",i.maxPoints=2,i.geometryFunction=function(e,t){var r=t;r||(r=new V.ZP([]));var o=e[0],n=e[1];return r.setCoordinates([[o,[o[0],n[1]],n,[n[0],o[1]],o]]),r};break;case"Circle":i.maxPoints=100,n.options&&n.options.geodesic?i.geometryFunction=function(t,r){var o=r;o||(o=new V.ZP([])).setProperties({geodesicCenter:de(t[0])},!0);var n=e.props.map.getView().getProjection().getCode(),a=de(t).map((function(t){return e.reprojectCoordinatesToWGS84(t,n)})),i=(0,L.calculateDistance)(a,"haversine"),s=(0,V.iu)(a[0],i).clone().transform("EPSG:4326",n).getCoordinates();return o.setCoordinates(s),o}:i.type=t;break;case"Marker":case"Point":case"Text":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":"LineString"===t&&(i.maxPoints=r);var s="Text"===t||"Marker"===t?"Point":t;i.type=s,i.geometryFunction=function(t,r){var o=r;return o||(o=e.createOLGeometry({type:s,coordinates:null,options:n.options})),o.setCoordinates(t),o};break;default:return{}}return E()({},a,i)})),be(he(e),"setDoubleClickZoomEnabled",(function(t){for(var r=e.props.map.getInteractions(),o=0;o<r.getLength();o++){var n=r.item(o);if(n instanceof ae.Z){n.setActive(t);break}}})),be(he(e),"updateFeatureExtent",(function(t){var r=t.features.getArray(),o=e.props.features.map((function(t){var o=c()(r.filter((function(r){return e.fromOLFeature(r).id===t.id})));return o?E()({},t,{geometry:o.geometry,center:o.center,extent:o.extent,coordinate:o.coordinates,radius:o.radius}):t}));e.props.onChangeDrawingStatus("replace",e.props.drawMethod,e.props.drawOwner,o)})),be(he(e),"addInteractions",(function(t){e.clean(),e.drawLayer||e.addLayer(t),e.addDrawInteraction(t.drawMethod,t.options.startingPoint,t.options.maxPoints,t),t.options&&t.options.editEnabled&&(e.addSelectInteraction(),e.translateInteraction&&e.props.map.removeInteraction(e.translateInteraction),e.translateInteraction=new ie.Z({features:e.selectInteraction.getFeatures()}),e.translateInteraction.setActive(!1),e.translateInteraction.on("translateend",e.updateFeatureExtent),e.props.map.addInteraction(e.translateInteraction),e.addTranslateListener(),e.modifyInteraction&&e.props.map.removeInteraction(e.modifyInteraction),e.modifyInteraction=new se.Z({features:e.selectInteraction.getFeatures(),condition:function(e){return(0,ne.Xp)(e)&&!(0,ne.Ko)(e)}}),e.props.map.addInteraction(e.modifyInteraction)),e.drawSource.clear(),t.features.length>0&&e.addFeatures(t)})),be(he(e),"addSingleClickListener",(function(e,t){return t.map.on("singleclick",e)})),be(he(e),"addDrawOrEditInteractions",(function(t){e.state&&e.state.keySingleClickCallback&&(0,pe.B)(e.state.keySingleClickCallback),e.clean();var r,o=t.features.map((function(r){return(0,L.reprojectGeoJson)(r,t.options.featureProjection,e.getMapCrs())||{}})),n=o.every((function(e){return!!(e&&e.features&&e.features.length)})),a=o.every((function(e){return!!(e&&e.properties&&e.properties.isCircle)}));if(n)r=E()({},t,{features:o});else if(a)r=E()({},t,{features:[]});else{var i=o.reduce((function(e,t){return t.geometry?[].concat(de(e),[ge(ge({},t.geometry),{},{properties:t.properties})]):e}),[]);r=E()({},t,{features:i})}e.drawLayer?(e.drawSource.clear(),e.addFeatures(r)):e.addLayer(r),t.options.editEnabled&&(!t.options.geodesic&&e.addModifyInteraction(t),!1!==t.options.translateEnabled&&e.addTranslateInteraction(),t.options.addClickCallback&&e.setState({keySingleClickCallback:e.addSingleClickListener((function(r){if(e.drawSource&&t.options){var o,n=e.drawSource.getFeatures(),a=0,i=n&&n.length&&n.filter((function(e,t){return e.getProperties().canEdit&&(a=t),e.getProperties().canEdit}))[0]||null,s=i&&i.getGeometry()&&i.getGeometry().getCoordinates&&i.getGeometry().getCoordinates()||[],c=[],p=t.drawMethod;switch(p){case"Polygon":c=s.length?(0,A.F7)(s)?[(c=(c=d()(s[0],0,s[0].length-1)).concat([r.coordinate])).concat([s[0][0]])]:s[0].length>1?[[].concat(de(s[0]),[r.coordinate,s[0][0]])]:[[].concat(de(s[0]),[r.coordinate])]:[[r.coordinate]],(o=e.getNewFeature(p,c)).setProperties(y()(i&&i.getProperties()||{},"geometry"));break;case"LineString":case"MultiPoint":c=s.length?[].concat(de(s),[r.coordinate]):[r.coordinate],(o=e.getNewFeature(p,c)).setProperties(y()(i&&i.getProperties()||{},"geometry"));break;case"Circle":p="Polygon";var u=i&&i.getProperties()&&i.getProperties().radius||1e4,l=r.coordinate,f=e.polygonCoordsFromCircle(l,u);if(t.options.geodesic){var g=e.props.map.getView().getProjection().getCode(),m=[de(l)].map((function(t){return e.reprojectCoordinatesToWGS84(t,g)}));f=(0,V.iu)(m[0],u).clone().transform("EPSG:4326",g).getCoordinates()}o=e.getNewFeature(p,f),l=(0,L.reproject)(l,e.getMapCrs(),"EPSG:4326",!1),o.setProperties(y()(i&&i.getProperties()||{},"geometry")),o.setProperties({isCircle:!0,radius:u,center:[l.x,l.y],isGeodesic:e.props.options.geodesic});break;case"Text":p="Point",(o=e.getNewFeature(p,r.coordinate)).setProperties(y()(i&&i.getProperties()||{},"geometry")),o.setProperties({isText:!0,valueText:i&&i.getProperties()&&i.getProperties().valueText||t.options.defaultTextAnnotation||"New"});break;default:c=r.coordinate,(o=e.getNewFeature(p,c)).setProperties(y()(i&&i.getProperties()||{},"geometry"))}var w={type:"Feature",geometry:{coordinates:de((0,L.reprojectGeoJson)(Se.writeFeaturesObject([o.clone()]),e.getMapCrs(),"EPSG:4326").features[0].geometry.coordinates),type:p},properties:ge({},y()(o.getProperties(),"geometry"))};e.props.onDrawingFeatures([w]),t.options.geodesic||(o=(0,Z.a)(o,e.getMapCrs())),n[a]=o,e.drawSource=new N.Z({features:n}),e.drawLayer.setSource(e.drawSource),e.addModifyInteraction(t)}}),t)})),t.options&&t.options.selectEnabled&&e.addSelectInteraction(t.options&&t.options.selected,t),t.options.drawEnabled&&e.handleDrawAndEdit(t.drawMethod,t.options.startingPoint,t.options.maxPoints,t)})),be(he(e),"addSelectInteraction",(function(t,r){var o;if(e.selectInteraction&&e.props.map.removeInteraction(e.selectInteraction),t&&(o=u()(e.drawSource.getFeatures(),(function(e){return e.getProperties().id===t.properties.id})))&&e.selectFeature(o),e.selectInteraction=new ce.Z({layers:[e.drawLayer],features:new oe.Z(t&&o?[o]:null)}),o){var n=e.convertGeometryTypeToStyleType(r.drawMethod);o.setStyle((0,W.C2)(ge(ge({},r),{},{style:ge(ge({},r.style),{},{type:n,highlight:!0,useSelectedStyle:r.options.useSelectedStyle})}),!1,r.features[0]&&r.features[0].properties&&r.features[0].properties.valueText&&[r.features[0].properties.valueText]||[]))}e.selectInteraction.on("select",(function(t){var r=e.selectInteraction.getFeatures().getArray(),o=[];return r.length&&(o=e.props.features.map((function(o){var n;if("FeatureCollection"===o.type&&r.length>0){var a=c()(r);if(e.selectFeature(a),a.getGeometry&&"Circle"===a.getGeometry().getType()){var i=a.getGeometry().getRadius(),s=(0,L.reproject)(a.getGeometry().getCenter(),e.getMapCrs(),"EPSG:4326");a.setProperties({center:[s.x,s.y],radius:i}),a=e.replaceCircleWithPolygon(a.clone())}return e.drawSource.getFeatures().forEach((function(t){t.getProperties().id===a.getProperties().id?e.selectFeature(a):e.deselectFeature(t)})),(0,L.reprojectGeoJson)(Se.writeFeatureObject(a.clone()),e.getMapCrs(),"EPSG:4326")}return n=r.reduce((function(e,t){return t.get("id")===o.id||e}),!1),E()({},o,{selected:n,selectedFeature:t.selected})})),e.props.onSelectFeatures(o)),0===r.length?(e.props.onSelectFeatures([]),e.drawSource.getFeatures().map((function(t){return e.deselectFeature(t)})),null):null})),e.props.map.addInteraction(e.selectInteraction)})),be(he(e),"selectFeature",(function(e){e.setProperties({selected:!0})})),be(he(e),"deselectFeature",(function(e){e.setProperties({selected:!1})})),be(he(e),"removeDrawInteraction",(function(){e.drawInteraction&&(e.props.map.removeInteraction(e.drawInteraction),e.drawInteraction=null,setTimeout((function(){return e.props.map.enableEventListener("singleclick")}),500),setTimeout((function(){return e.setDoubleClickZoomEnabled(!0)}),250))})),be(he(e),"removeInteractions",(function(){e.removeDrawInteraction(),e.selectInteraction&&(e.props.map.enableEventListener("singleclick"),e.props.map.removeInteraction(e.selectInteraction)),e.modifyInteraction&&(e.props.map.removeInteraction(e.modifyInteraction),e.props.map.un("singleclick")),e.translateInteraction&&e.props.map.removeInteraction(e.translateInteraction)})),be(he(e),"clean",(function(t){t||e.removeInteractions(),e.drawLayer&&(e.props.map.removeLayer(e.drawLayer),e.geojson=null,e.drawLayer=null,e.drawSource=null)})),be(he(e),"fromOLFeature",(function(t,r,o){var n=t.getGeometry(),a=e.props.map.getView().getProjection().getCode(),s=n.getType();if(n.getCoordinates){var c,p=n.getExtent(),u=n.getProperties(),l=u&&u.geodesicCenter||(0,ue.qg)(p),d=n.getCoordinates();if(r&&(d=i()(r,d),n.setCoordinates(d)),"Circle"===e.props.drawMethod)if(e.props.options.geodesic){var f=[de(l),de(d[0][0])].map((function(t){return e.reprojectCoordinatesToWGS84(t,a)}));c=(0,L.calculateDistance)(f,"haversine")}else c=e.calculateRadius(l,d);return E()({},{id:t.get("id"),type:s,extent:p,center:l,coordinates:d,radius:c,style:e.fromOlStyle(t.getStyle()),projection:e.getMapCrs()})}var y=n.getGeometries().map((function(n,s){var c,p=n.getExtent(),u=(0,ue.qg)(p),l=n.getCoordinates();if(r&&(l=i()(r,l),n.setCoordinates(l)),o.circles&&-1!==o.circles.indexOf(s))if(e.props.options.geodesic){var d=[de(u),de(l[0][0])].map((function(t){return e.reprojectCoordinatesToWGS84(t,a)}));c=(0,L.calculateDistance)(d,"haversine")}else c=e.calculateRadius(u,l);else c=0;return E()({},{id:t.get("id"),type:n.getType(),extent:p,center:u,coordinates:l,radius:c,style:e.fromOlStyle(t.getStyle()),projection:e.getMapCrs()})}));return E()({},{type:"Feature",id:t.get("id"),style:e.fromOlStyle(t.getStyle()),geometry:{type:"GeometryCollection",geometries:y},projection:a})})),be(he(e),"reprojectCoordinatesToWGS84",(function(e,t){var r=(0,L.reproject)(e,t,"EPSG:4326");return[r.x,r.y]})),be(he(e),"toOlFeature",(function(t){return c()(e.drawSource.getFeatures().filter((function(e){return e.get("id")===t.id})))})),be(he(e),"fromOlStyle",(function(t){return t?{fillColor:e.rgbToHex(t.getFill().getColor()),fillTransparency:t.getFill().getColor()[3],strokeColor:t.getStroke().getColor(),strokeWidth:t.getStroke().getWidth(),text:t.getText().getText()}:{}})),be(he(e),"toOlStyle",(function(t,r,o){var n=t&&t.fillColor?t.fillColor:[255,255,255,.2];"string"==typeof n&&(n=e.hexToRgb(n).concat([t.fillOpacity>=0&&t.fillOpacity<=1?t.fillOpacity:1])),t&&t.fillTransparency&&(n[3]=t.fillTransparency);var a=t&&(t.strokeColor||t.color)?t.strokeColor||t.color:"#ffcc33";r&&(a="#4a90e2"),a=e.hexToRgb(a).concat([t&&t.opacity||1]);var i=new Q.default({fill:new Y.default({color:n}),stroke:new ee.default({color:a,width:t&&(t.strokeWidth||t.weight)?t.strokeWidth||t.weight:2}),text:new te.default({text:t&&t.text?t.text:"",fill:new Y.default({color:t&&(t.strokeColor||t.color)?t.strokeColor||t.color:"#000"}),stroke:new ee.default({color:"#fff",width:2}),font:t&&t.fontSize?t.fontSize+"px helvetica":""})});return"GeometryCollection"===o?[].concat(de((0,W.EC)({style:{iconGlyph:"comment",iconShape:"square",iconColor:"blue"}})),[i]):t&&(t.iconUrl||t.iconGlyph)?(0,W.EC)({style:t}):i})),be(he(e),"hexToRgb",(function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,r,o){return t+t+r+r+o+o})));return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null})),be(he(e),"componentToHex",(function(e){var t=e.toString(16);return 1===t.length?"0"+t:t})),be(he(e),"rgbToHex",(function(t){return"#"+e.componentToHex(t[0])+e.componentToHex(t[1])+e.componentToHex(t[2])})),be(he(e),"addModifyInteraction",(function(t){e.modifyInteraction&&e.props.map.removeInteraction(e.modifyInteraction);var r=t&&t.options&&t.options.editFilter;e.modifyFeatureColl=new oe.Z(h()(e.drawLayer.getSource().getFeatures(),r)),e.modifyInteraction=new se.Z({features:e.modifyFeatureColl,condition:function(e){return(0,ne.Xp)(e)&&!(0,ne.Ko)(e)}}),e.modifyInteraction.on("modifyend",(function(t){var r=t.features.getArray().map((function(t){var r=t.clone();if(r.getGeometry&&"GeometryCollection"===r.getGeometry().getType()&&r.getGeometry().setGeometries(e.replaceCirclesWithPolygons(r)),r.getGeometry&&r.getGeometry()&&"Circle"===r.getGeometry().getType()){var o=(0,L.reproject)(r.getGeometry().getCenter(),e.getMapCrs(),"EPSG:4326"),n=r.getGeometry().getRadius();r.setProperties({center:[o.x,o.y],radius:n}),t.setProperties({center:[o.x,o.y],radius:n}),r=e.replaceCircleWithPolygon(r.clone())}return(0,L.reprojectGeoJson)(Se.writeFeatureObject(r),e.getMapCrs(),"EPSG:4326")}));e.props.options.transformToFeatureCollection?e.props.onDrawingFeatures(r):e.props.onGeometryChanged(r,e.props.drawOwner,!1,"editing","editing")})),e.props.map.addInteraction(e.modifyInteraction)})),be(he(e),"addTranslateInteraction",(function(){e.translateInteraction&&e.props.map.removeInteraction(e.translateInteraction),e.translateInteraction=new ie.Z({features:new oe.Z(e.drawLayer.getSource().getFeatures())}),e.translateInteraction.setActive(!1),e.translateInteraction.on("translateend",(function(t){var r=t.features.getArray().map((function(t){var r=t.clone();if(r.getGeometry&&"GeometryCollection"===r.getGeometry().getType()&&r.getGeometry().setGeometries(e.replaceCirclesWithPolygons(r)),r.getGeometry&&r.getGeometry()&&"Circle"===r.getGeometry().getType()){var o=(0,L.reproject)(r.getGeometry().getCenter(),e.getMapCrs(),"EPSG:4326"),n=r.getGeometry().getRadius();r.setProperties({center:[o.x,o.y],radius:n}),r=e.replaceCircleWithPolygon(r)}return t.getProperties()&&t.getProperties().selected&&e.props.onSelectFeatures([(0,L.reprojectGeoJson)(Se.writeFeatureObject(r),e.getMapCrs(),"EPSG:4326")]),(0,L.reprojectGeoJson)(Se.writeFeatureObject(r),e.getMapCrs(),"EPSG:4326")}));e.props.options.transformToFeatureCollection?e.props.onDrawingFeatures(r):e.props.onGeometryChanged(r,e.props.drawOwner,e.props.drawOwner,!1,"Text"===e.props.drawMethod,"Circle"===e.props.drawMethod)})),e.addTranslateListener(),e.props.map.addInteraction(e.translateInteraction)})),be(he(e),"createOLGeometry",(function(t){var r=t.type,o=t.coordinates,n=t.radius,a=t.center,i=t.geometries,s=t.projection,c=t.options,p=void 0===c?{}:c;return"GeometryCollection"===r?i&&i.length?new $.default(i.map((function(t){return e.olGeomFromType({type:t.type})}))):new $.default([]):e.olGeomFromType({type:r,coordinates:o,radius:n,center:a,projection:s,options:p})})),be(he(e),"olGeomFromType",(function(t){var r,o=t.type,n=t.coordinates,a=t.radius,i=t.center,s=t.projection,c=t.options;switch(o){case"Point":case"Marker":case"Text":r=new K.Z(n||[]);break;case"LineString":r=new U.Z(n||[]);break;case"MultiPoint":r=new H.Z(n||[]);break;case"MultiLineString":r=new q.Z(n||[]);break;case"MultiPolygon":r=new z.Z(n||[]);break;default:var p=m()(i)?{x:i[0],y:i[1]}:i,u=s&&!isNaN(parseFloat(a))&&p&&!b()(p.x)&&!b()(p.y)&&!isNaN(parseFloat(p.x))&&!isNaN(parseFloat(p.y));(r=u?c.geodesic?(0,V.iu)(e.reprojectCoordinatesToWGS84([p.x,p.y],s),a,100).clone().transform("EPSG:4326",s):(0,V.Bb)(new X.Z([p.x,p.y],a),100):new V.ZP(n&&m()(n[0])?n:[]))&&u&&c.geodesic&&r.setProperties({geodesicCenter:[p.x,p.y]},!0)}return r})),be(he(e),"convertGeometryTypeToStyleType",(function(e){return"BBOX"===e?"LineString":e})),be(he(e),"appendToMultiGeometry",(function(e,t,r){switch(e){case"MultiPoint":t.appendPoint(r);break;case"MultiLineString":t.appendLineString(r);break;case"MultiPolygon":var o=r.getCoordinates();o[0].push(o[0][0]),r.setCoordinates(o),t.appendPolygon(r)}})),be(he(e),"calculateRadius",(function(e,t){return m()(t)&&m()(t[0])&&m()(t[0][0])?Math.sqrt(Math.pow(e[0]-t[0][0][0],2)+Math.pow(e[1]-t[0][0][1],2)):100})),be(he(e),"polygonFromCircle",(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,V.Bb)(new X.Z(e,t),r)})),be(he(e),"polygonCoordsFromCircle",(function(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return e.polygonFromCircle(t,r,o).getCoordinates()})),be(he(e),"replaceCirclesWithPolygonsInFeatureColl",(function(t){return t.map((function(t){return"Circle"!==t.getGeometry().getType()?t:e.replaceCircleWithPolygon(t)}))})),be(he(e),"replaceCircleWithPolygon",(function(t){if(t.getProperties().isCircle&&"Circle"===t.getGeometry().getType()){var r=t.getGeometry().getCenter(),o=t.getGeometry().getRadius();return t.setGeometry(e.polygonFromCircle(r,o)),t}return t})),be(he(e),"replaceCirclesWithPolygons",(function(t){return t.getGeometry&&!t.getGeometry().getGeometries?t:t.getGeometry().getGeometries().map((function(r,o){if("Circle"!==r.getType())return r;if(t.getProperties()&&t.getProperties().circles&&-1!==t.getProperties().circles.indexOf(o)){var n=r.getCenter(),a=r.getRadius();return e.polygonFromCircle(n,a)}return r}))})),be(he(e),"replacePolygonsWithCircles",(function(t){return t.getGeometry().getGeometries().map((function(r,o){if("Polygon"!==r.getType())return r;if(t.getProperties()&&t.getProperties().circles&&-1!==t.getProperties().circles.indexOf(o)){var n=r.getExtent(),a=(0,ue.qg)(n),i=e.calculateRadius(a,r.getCoordinates());return new X.Z(a,i)}return r}))})),be(he(e),"addTranslateListener",(function(){document.addEventListener("keydown",(function(t){t.altKey&&"AltLeft"===t.code&&e.translateInteraction.setActive(!0)})),document.addEventListener("keyup",(function(t){"AltLeft"===t.code&&e.translateInteraction.setActive(!1)}))})),e}return t=s,(r=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(this.drawLayer&&this.updateFeatureStyles(e.features),!e.drawStatus&&this.selectInteraction&&this.selectInteraction.getFeatures().clear(),this.props.drawStatus!==e.drawStatus||this.props.drawMethod!==e.drawMethod||this.props.features!==e.features)switch(e.drawStatus){case"create":this.addLayer(e);break;case"start":this.addInteractions(e);break;case"drawOrEdit":this.addDrawOrEditInteractions(e);break;case"stop":this.removeDrawInteraction();break;case"replace":this.replaceFeatures(e);break;case"updateStyle":this.updateOnlyFeatureStyles(e);break;case"clean":this.clean();break;case"cleanAndContinueDrawing":this.clean(!0);break;case"endDrawing":this.endDrawing(e);break;default:return}}},{key:"render",value:function(){return null}}])&&we(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(n().Component);be(Ge,"propTypes",{map:O().object,drawOwner:O().string,drawStatus:O().string,drawMethod:O().string,options:O().object,features:O().array,onChangeDrawingStatus:O().func,onGeometryChanged:O().func,onDrawStopped:O().func,onDrawingFeatures:O().func,onSelectFeatures:O().func,onEndDrawing:O().func,style:O().object}),be(Ge,"defaultProps",{map:null,drawOwner:null,drawStatus:null,drawMethod:null,features:null,options:{stopAfterDrawing:!0},onChangeDrawingStatus:function(){},onGeometryChanged:function(){},onDrawStopped:function(){},onDrawingFeatures:function(){},onSelectFeatures:function(){},onEndDrawing:function(){}})},26105:(e,t,r)=>{"use strict";r.d(t,{Z:()=>F});var o=r(24852),n=r.n(o),a=r(80307),i=r.n(a),s=r(45697),c=r.n(s),p=r(93409),u=r(47037),l=r.n(u),d=r(25064),f=r(21751);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){S(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function C(e,t){return C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},C(e,t)}function h(e,t){if(t&&("object"===y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return P(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},b(e)}function S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var G=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=new MutationObserver((function(){e.getMap().getSize()&&(e.setPosition(void 0),e.setPosition(r.coordinates))}));return o.observe(t,{attributes:!0,childList:!0,subtree:!0}),o},F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}(c,e);var t,r,o,a,s=(o=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(o);if(a){var r=b(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return h(this,e)});function c(){var e;w(this,c);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return S(P(e=s.call.apply(s,[this].concat(r))),"onPopupClose",(function(t){e.props.onPopupClose(t)})),S(P(e),"renderPopups",(function(){return e.preparePopups().map((function(t){var r,o=t.popup,a=t.id,s=t.component,c=t.content,p=t.props,u=t.containerStyle,y=o.getElement(),g=l()(s)&&f.default[s]||s;return g?r=n().isValidElement(g)&&g||n().createElement(g,p):c&&(r=d.FP(c)?n().createElement("div",{dangerouslySetInnerHTML:{__html:c}}):c),y&&i().createPortal(n().createElement("div",{className:"map-popup-ol",key:a,onMouseUp:e.convertToClick},n().createElement("div",{className:"ol-popup-content-wrapper"},n().createElement("div",{className:"ol-popup-content",style:u},r)),n().createElement("div",{className:"ol-popup-closer",onClick:function(){return e.onPopupClose(a)}},"x")),y)}))})),S(P(e),"update",(function(){(e._popups||[]).map((function(e){var t=e.popup;t.setElement(t.getElement())}))})),S(P(e),"convertToClick",(function(e){var t=new MouseEvent("click",{bubbles:!0});t.stopPropagation=function(){},e.target.dispatchEvent(t)})),S(P(e),"preparePopups",(function(){var t=e.props,r=t.popups,o=void 0===r?[]:r,n=t.map,a=n.getSize();return(e._popups||[]).forEach((function(e){var t=e.popup,r=e.observer;r&&r.disconnect(),t&&n.removeOverlay(t)})),e._popups=o.map((function(e){var t=Math.round(.9*a[0])-40,r=Math.round(.9*a[1])-40,o=e.id,i=e.position.coordinates,s=e.className,c=e.maxWidth,u=void 0===c?t:c,l=e.maxHeight,f=void 0===l?r:l,y=e.autoPan,g=void 0!==y&&y,w=e.autoPanMargin,v=void 0===w?20:w,C=e.offset,h=void 0===C?[0,0]:C,P=e.autoPanAnimation,b=void 0===P?{duration:200}:P,S=u>t?t:u,F=f>r?r:f,O=d.fH(o,s),I=new p.Z({id:o,element:O,autoPan:g,offset:h,autoPanMargin:v,autoPanAnimation:b,positioning:"bottom-center",className:"ol-overlay-container ol-unselectable",position:i});return n.addOverlay(I),m({popup:I,observer:G(I,O,{coordinates:i}),containerStyle:{maxWidth:S,maxHeight:F}},e)})),e._popups})),S(P(e),"stopPropagationOnPointerMove",(function(e){e.stopPropagation()})),e}return t=c,(r=[{key:"UNSAFE_componentWillMount",value:function(){this.props.map&&this.props.map.getOverlayContainerStopEvent().addEventListener("pointermove",this.stopPropagationOnPointerMove)}},{key:"shouldComponentUpdate",value:function(e){return e.popups!==this.props.popups}},{key:"componentWillUnmount",value:function(){this.props.map&&this.props.map.getOverlayContainerStopEvent().removeEventListener("pointermove",this.stopPropagationOnPointerMove)}},{key:"render",value:function(){return n().createElement("div",null,this.renderPopups())}}])&&v(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(n().Component);S(F,"propTypes",{map:c().object,popups:c().arrayOf(c().object),onPopupClose:c().func}),S(F,"defaultProps",{popups:[],onPopupClose:function(){}})}}]);