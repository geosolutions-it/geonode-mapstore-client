(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[8973],{49537:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>to});var o=r(18446),n=r.n(o),a=r(45697),i=r.n(a),l=r(24852),s=r.n(l),p=r(71703),u=r(6806),c=r(12838),f=r(22222),d=r(82904),y=r(4206),m=r(90825),b=r(40512),g=r(80416),h=r(1550),v=r(7878),F=r(95797),O=(r(65207),r(72986)),E=r.n(O),w=r(65539),P=r(5346),S=r(12346),j=r(30294),C=r(43129),x=r(20),T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.item;return s().createElement("span",null,t&&t.name?s().createElement(P.Z,{msgId:t.name}):null)};const q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.spatialOperations,r=void 0===t?[]:t,o=e.onChange,n=void 0===o?function(){}:o,a=e.value;return s().createElement(x.DropdownList,{valueField:"id",className:"geometry-operation-selector",onChange:n,data:r,valueComponent:T,value:a,itemComponent:T})};var N=r(31071),D=r(11847),I=r(2576);function L(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}var M=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.search,o=t.url;return(0,D.w0)(e,o)||(0,D.w0)(e,r&&r.url)},R=function(e){return(e||[]).filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return"BBOX"!==t}))},k=r(27361),B=r.n(k),A=r(13311),Z=r.n(A),V=r(49977),G=r.n(V),U=r(86850),W=r(78889),z={"xsd:normalizedString":"string","xsd:string":"string","xsd:date":"date","xsd:dateTime":"date","xsd:date-time":"date-time","xsd:time":"time","xsd:decimal":"number","xsd:int":"number","xsd:integer":"number","xsd:long":"number","xsd:negativeInteger":"number","xsd:nonNegativeInteger":"number","xsd:nonPositiveInteger":"number","xsd:positiveInteger":"number","xsd:short":"number","xsd:unsignedLong":"number","xsd:unsignedInt":"number","xsd:unsignedShort":"number","xsd:number":"number","xsd:boolean":"boolean","xsd:double":"number","xsd:float":"number"},Q=function(e){return B()(e,"featureTypes[0].properties").filter((function(e){return 0!==e.type.indexOf("gml:")&&z[e.type]})).map((function(e){return{label:e.name,attribute:e.name,type:z[e.type],valueId:"id",valueLabel:"name",values:[]}}))},H=r(67076),X=r(73849);function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach((function(t){J(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function J(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var K=function(e){return e.distinctUntilChanged((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.searchUrl,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.searchUrl;return t===o})).switchMap((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.crossLayerExpanded?V.Observable.of(t):e.filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.crossLayerExpanded;return t})).take(1)})).switchMap((function(e){var t=e.featureTypeName,r=e.searchUrl;return(0,U.ED)({layer:{name:t,url:r,search:{type:"wfs",url:r}}}).do((function(e){if(t=e,r=B()(t,"WFS_Capabilities.Filter_Capabilities.Scalar_Capabilities.ArithmeticOperators.Functions.FunctionNames.FunctionName"),!Z()(r,(function(){return"queryCollection"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})._})))throw new Error("nocrosslayerfunctionalities");var t,r})).map((function(){return{loadingCapabilities:!1}})).catch((function(e){return V.Observable.of({errorObj:e,loadingAttributes:!1,loadingCapabilities:!1,featureTypeProperties:[]})})).startWith({loadingCapabilities:!0})})).startWith({})},ee=function(e,t){return e.distinctUntilChanged((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,r=void 0===t?{}:t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.layer;return n&&r.name===(n&&n.name)})).filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.layer;return!!t})).switchMap((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.layer;return V.Observable.defer((function(){return(0,U.v$)({layer:r})})).do((function(e){var r=B()((0,W.findGeometryProperty)(e.data||{}),"name");r&&t("geometryName",r)})).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,r=void 0===t?{}:t;return Q(r)})).map((function(e){return{attributes:e,loadingAttributes:!1}})).startWith({loadingAttributes:!0}).catch((function(e){return V.Observable.of({errorObj:e,loadingAttributes:!1,featureTypeProperties:[]})}))})).catch((function(e){return V.Observable.of({errorObj:e,loadingAttributes:!1,loadingCapabilities:!1,featureTypeProperties:[]})})).startWith({})};const te=(0,H.compose)((0,H.withPropsOnChange)(["crossLayerFilter"],(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.crossLayerFilter,r=void 0===t?{}:t;return{queryCollection:B()(r,"collectGeometries.queryCollection"),operation:B()(r,"operation"),distance:B()(r,"distance")}})),(0,H.withProps)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.layers,r=void 0===t?[]:t,o=e.queryCollection,n=void 0===o?{}:o;return{layer:Z()(r,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name;return t===n.typeName}))}})),(0,H.withHandlers)({setQueryCollectionParameter:function(e){var t=e.setCrossLayerFilterParameter,r=void 0===t?function(){}:t;return function(e,t){r("collectGeometries.queryCollection[".concat(e,"]"),t),"typeName"===e&&r("collectGeometries.queryCollection.filterFields",[])}},updateLogicCombo:function(e){var t=e.setCrossLayerFilterParameter,r=void 0===t?function(){}:t;return function(e,t){return r("collectGeometries.queryCollection.groupFields",[{id:e,logic:t,index:0}])}},setOperation:function(e){var t=e.setCrossLayerFilterParameter,r=void 0===t?function(){}:t;return function(e){return r("operation",e)}}}),(0,H.defaultProps)({dataStreamFactory:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.setQueryCollectionParameter,o=void 0===r?function(){}:r;return K(e).combineLatest(ee(e,o),(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Y(Y({},t),e)})).startWith({})}}),X.Z);var re=r(43614),oe=r(47805),ne=r(38560),ae=r(80717);function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function le(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function se(e,t){return se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},se(e,t)}function pe(e,t){if(t&&("object"===ie(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ue(e)}function ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ce(e){return ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ce(e)}function fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var de=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&se(e,t)}(l,e);var t,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ce(o);if(a){var r=ce(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return pe(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),fe(ue(t=i.call(this,e)),"getCurrentFilter",(function(){return{featureTypeName:t.props.featureTypeName,groupFields:t.props.groupFields,filterFields:t.props.sendFilters&&t.props.sendFilters.attributeFilter&&t.props.filterFields.filter((function(e){return(0,oe.checkOperatorValidity)(e.value,e.operator)}))||[],spatialField:t.props.sendFilters&&t.props.sendFilters.spatialFilter&&t.props.spatialField||{attribute:t.props.spatialField&&t.props.spatialField.attribute},pagination:t.props.pagination,filterType:t.props.filterType,ogcVersion:t.props.ogcVersion,sortOptions:t.props.sortOptions,crossLayerFilter:t.props.sendFilters&&t.props.sendFilters.crossLayerFilter&&(0,oe.setupCrossLayerFilterDefaults)(t.props.crossLayerFilter)||null,hits:t.props.hits}})),fe(ue(t),"isCurrentFilterChanged",(function(){var e=t.getCurrentFilter(),r={groupFields:e.groupFields,filterFields:e.filterFields,spatialField:e.spatialField,crossLayerFilter:e.crossLayerFilter},o=t.props.appliedFilter||{},a={groupFields:o.groupFields,filterFields:o.attributePanelExpanded&&o.filterFields||[],spatialField:o.spatialPanelExpanded&&o.spatialField||{attribute:t.props.spatialField&&t.props.spatialField.attribute},crossLayerFilter:o.crossLayerExpanded&&o.crossLayerFilter&&o.crossLayerFilter.operation?(0,oe.setupCrossLayerFilterDefaults)(o.crossLayerFilter):null};return!n()(r,a)})),fe(ue(t),"search",(function(){var e=t.getCurrentFilter();t.props.actions.onQuery(t.props.searchUrl,e,t.props.params),t.props.advancedToolbar&&t.props.actions.storeAppliedFilter()})),fe(ue(t),"reset",(function(){if(t.props.actions.onChangeDrawingStatus("clean","","queryform",[]),t.props.actions.onReset(),t.props.advancedToolbar){var e={featureTypeName:t.props.featureTypeName,groupFields:[],filterFields:[],spatialField:{attribute:t.props.spatialField&&t.props.spatialField.attribute},pagination:t.props.pagination,filterType:t.props.filterType,ogcVersion:t.props.ogcVersion,sortOptions:t.props.sortOptions,crossLayerFilter:null,hits:t.props.hits};t.props.actions.onQuery(t.props.searchUrl,e,t.props.params),t.props.advancedToolbar&&t.props.actions.storeAppliedFilter()}})),fe(ue(t),"restorePersistedFilter",(function(){t.props.actions.onRestoreFilter()})),t}return t=l,(r=[{key:"render",value:function(){var e=this,t=this.props.filterFields.filter((function(e){return e.exception})).length>0,r=this.props.allowEmptyFilter&&!this.props.advancedToolbar,o=this.props.filterFields.filter((function(e){return e.value||0===e.value})).length>0,a=(0,oe.isFilterEmpty)(this.props),i=(0,oe.isFilterEmpty)(this.props.appliedFilter),l=this.isCurrentFilterChanged(),p=o||this.props.spatialField.geometry||(0,oe.isCrossLayerFilterValid)(this.props.crossLayerFilter),u=!n()(this.props.appliedFilter,this.props.storedFilter),c=r||a&&this.props.appliedFilter&&!i,f=t||!this.props.toolbarEnabled||a&&!c||!a&&(!p||!l),d=this.props.emptyFilterWarning&&a&&l,y=this.props.advancedToolbar?"queryform.apply":this.props.queryBtnMsgId,m=[{tooltipId:d?"queryform.emptyfilter":y,disabled:f,noTooltipWhenDisabled:!0,glyph:this.props.advancedToolbar?"ok":this.props.queryBtnGlyph,className:d?"square-button-md showWarning":"square-button-md",id:"query-toolbar-query",onClick:this.search}];if(this.props.advancedToolbar){var b=!u||this.props.loadingError||l,g=!u||!this.props.storedFilter||!this.props.toolbarEnabled,h=!this.props.appliedFilter||this.props.appliedFilter&&i||!this.props.toolbarEnabled;m=m.concat([{tooltipId:"queryform.save",disabled:b,noTooltipWhenDisabled:!0,glyph:"floppy-disk",id:"query-toolbar-save",onClick:this.props.actions.onSaveFilter},{tooltipId:"queryform.discard",disabled:g,noTooltipWhenDisabled:!0,glyph:"undo",id:"query-toolbar-discard",onClick:this.restorePersistedFilter},{tooltipId:"queryform.reset",glyph:"clear-filter",noTooltipWhenDisabled:!0,id:"reset",disabled:h,onClick:this.reset}])}else m=[{tooltipId:"queryform.reset",glyph:"clear-filter",noTooltipWhenDisabled:!0,id:"reset",disabled:!this.props.toolbarEnabled,onClick:this.reset}].concat(m);return s().createElement("div",{className:"container-fluid query-toolbar"},s().createElement(ae.Z,{btnDefaultProps:{bsStyle:"primary",className:"square-button-md",tooltipPosition:"bottom"},className:"queryFormToolbar row-fluid pull-right",buttons:m}),s().createElement(re.Z,{show:!!this.props.showGeneratedFilter,bsSize:"large"},s().createElement(re.Z.Header,null,s().createElement(re.Z.Title,null,this.props.resultTitle)),s().createElement(re.Z.Body,null,s().createElement("textarea",{style:{width:"862px",maxWidth:"862px",height:"236px",maxHeight:"236px"}},this.props.showGeneratedFilter)),s().createElement(re.Z.Footer,null,s().createElement(ne.Z,{style:{float:"right"},onClick:function(){return e.props.actions.onQuery(null,null)}},"Close"))))}}])&&le(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(s().Component);fe(de,"propTypes",{filterType:i().string,params:i().object,filterFields:i().array,groupFields:i().array,spatialField:i().object,sendFilters:i().object,crossLayerFilter:i().object,toolbarEnabled:i().bool,searchUrl:i().string,showGeneratedFilter:i().oneOfType([i().bool,i().string]),featureTypeName:i().string,actions:i().object,ogcVersion:i().string,titleMsgId:i().string,queryBtnMsgId:i().string,resultTitle:i().string,queryBtnGlyph:i().string,pagination:i().object,sortOptions:i().object,hits:i().bool,allowEmptyFilter:i().bool,emptyFilterWarning:i().bool,appliedFilter:i().object,storedFilter:i().object,advancedToolbar:i().bool,loadingError:i().bool}),fe(de,"defaultProps",{sendFilters:{attributeFilter:!0,spatialFilter:!0,crossLayerFilter:!0},filterType:"OGC",params:{},groupFields:[],filterFields:[],spatialField:{},toolbarEnabled:!0,searchUrl:null,showGeneratedFilter:!1,featureTypeName:null,titleMsgId:"queryform.title",queryBtnMsgId:"queryform.query",resultTitle:"Generated Filter",queryBtnGlyph:"search",pagination:null,sortOptions:null,hits:!1,allowEmptyFilter:!1,emptyFilterWarning:!1,advancedToolbar:!1,loadingError:!1,actions:{onQuery:function(){},onReset:function(){},onChangeDrawingStatus:function(){},onSaveFilter:function(){},onRestoreFilter:function(){},storeAppliedFilter:function(){}}});const ye=de;var me=r(14293),be=r.n(me),ge=r(76364),he=r(86638),ve=r(38167),Fe=r(73333),Oe=r(1469),Ee=r.n(Oe),we=r(28878),Pe=r(59286),Se=r(91175),je=r.n(Se),Ce=r(50966),xe=r(48384);function Te(e){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(e)}function qe(){return qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},qe.apply(this,arguments)}function Ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function De(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ie(e,t){return Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ie(e,t)}function Le(e,t){if(t&&("object"===Te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _e(e)}function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Me(e){return Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Me(e)}function Re(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ie(e,t)}(i,e);var t,r,o,n,a=(o=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Me(o);if(n){var r=Me(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Le(this,e)});function i(){var e;Ne(this,i);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return Re(_e(e=a.call.apply(a,[this].concat(r))),"state",{}),Re(_e(e),"renderWithTooltip",(function(t){if(e.props.tooltip.customizedTooltip){var r=e.props.tooltip.customizedTooltip;return s().createElement(r,null,t)}var o=s().createElement(j.Tooltip,{id:e.props.tooltip.id},"this.props.tooltip.message");return s().createElement(Ce.Z,{key:e.props.tooltip.overlayTriggerKey,placement:e.props.tooltip.placement,overlay:o},t)})),Re(_e(e),"renderPagination",(function(){var t=e.props.pagination.firstPage,r=e.props.pagination.lastPage;return s().createElement("div",{className:"autocomplete-toolbar"},!t&&s().createElement(j.Glyphicon,{className:e.props.prevPageIcon,glyph:e.props.prevPageIcon,onClick:function(){return e.props.pagination.loadPrevPage()}}),!r&&s().createElement(j.Glyphicon,{className:e.props.nextPageIcon,glyph:e.props.nextPageIcon,onClick:function(){return e.props.pagination.loadNextPage()}}))})),Re(_e(e),"renderField",(function(){var t,r={emptyList:function(){return e.props.busy?"Loading...":(0,he.S$)(e.context.messages,"queryform.attributefilter.autocomplete.emptyList")},open:(0,he.S$)(e.context.messages,"queryform.attributefilter.autocomplete.open"),emptyFilter:(0,he.S$)(e.context.messages,"queryform.attributefilter.autocomplete.emptyFilter")},o=[];e.props.data&&e.props.data.length>0&&(o=e.props.data.map((function(e){return e}))),e.props.pagination&&e.props.pagination.paginated&&o.length>0&&o.push((Re(t={},e.props.textField,""),Re(t,e.props.valueField,""),Re(t,"disabled",!0),Re(t,"pagination",e.renderPagination()),t));var n=!1,a=e.props.loading?[]:o,i=e.props.itemComponent,l=s().createElement(x.Combobox,{dropUp:e.props.dropUp,busy:e.props.busy,data:a,disabled:e.props.disabled,itemComponent:function(t){return s().createElement(i,qe({textField:e.props.textField,valueField:e.props.valueField},t))},messages:e.props.messages||r,open:e.props.open,filter:!1,onChange:function(t){e.props.onChange(t,e.props.valueField),n=!0},onFocus:function(){return e.props.onFocus(e.props.data)},onSelect:function(t){var r=je()(e.props.features.filter((function(r){return r.properties[e.props.valueField].toLowerCase()===t[e.props.valueField].toLowerCase()})));e.props.onSelect(t,r,e.props.srsName,e.props.style)},onToggle:function(t){var r=je()(e.props.features.filter((function(t){return t.properties[e.props.valueField].toLowerCase()===e.props.selectedValue.toLowerCase()})));!t||e.props.selectedValue||e.props.selectedValue||n||e.props.onChange("",e.props.valueField),e.props.onToggle(t,r,e.props.pagination.currentPage),r&&!t&&e.props.onSelect(e.props.selectedValue,r,e.props.srsName,e.props.style),n=!1},textField:e.props.textField,valueField:e.props.valueField,value:e.props.selectedValue});return e.props.tooltip&&e.props.tooltip.enabled?e.renderWithTooltip(l):l})),e}return t=i,(r=[{key:"render",value:function(){var e=this.props.label?s().createElement("label",null,this.props.label):s().createElement("span",null);return s().createElement("div",{className:"autocompleteField"},e,this.renderField())}}])&&De(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(s().Component);Re(ke,"propTypes",{busy:i().bool,data:i().array,disabled:i().bool,dropUp:i().bool,features:i().array,filter:i().string,itemComponent:i().oneOfType([i().object,i().func]),label:i().string,loading:i().bool,messages:i().object,onChange:i().func,onFocus:i().func,onSelect:i().func,onToggle:i().func,onChangeDrawingStatus:i().func,style:i().style,open:i().bool,pagination:i().object,nextPageIcon:i().string,prevPageIcon:i().string,selectedValue:i().string,srsName:i().string,textField:i().string,tooltip:i().object,valueField:i().string}),Re(ke,"contextTypes",{messages:i().object}),Re(ke,"defaultProps",{dropUp:!1,features:[],filter:"",itemComponent:xe.Z,loading:!1,label:null,pagination:{paginated:!0,firstPage:!1,lastPage:!1,loadPrevPage:function(){},loadNextPage:function(){}},nextPageIcon:"chevron-right",prevPageIcon:"chevron-left",onFocus:function(){},onToggle:function(){},onChange:function(){},onChangeDrawingStatus:function(){},onSelect:function(){},srsName:"EPSG:4326",textField:"label",tooltip:{customizedTooltip:void 0,enabled:!1,id:"",message:void 0,overlayTriggerKey:"",placement:"top"},valueField:"value"});const Be=ke;function Ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(r),!0).forEach((function(t){Ve(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ve(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(0,H.setObservableConfig)(we.Z);var Ge=(0,H.mapPropsStreamWithConfig)(we.Z)((function(e){return e.take(1).switchMap((function(t){return t.autocompleteStreamFactory(e)})).combineLatest(e,(function(e,t){return Ze(Ze({},t),{},{data:Ee()(e&&e.fetchedData&&e.fetchedData.values)?e.fetchedData.values:[],features:Ee()(e&&e.fetchedData&&e.fetchedData.features)?e.fetchedData.features:[],valuesCount:e&&e.fetchedData&&e.fetchedData.size,srsName:e&&e.fetchedData&&e.fetchedData.crs,busy:e.busy})}))}))((function(e){var t=e.open,r=e.toggle,o=e.select,n=e.focus,a=e.change,i=e.changed,l=e.originalValue,p=e.value,u=e.valuesCount,c=e.onChangeDrawingStatus,f=e.loadNextPage,d=e.loadPrevPage,y=e.maxFeatures,m=e.currentPage,b=e.itemComponent,g=e.features,h=e.busy,v=e.data,F=e.loading,O=void 0!==F&&F,E=e.valueField,w=e.textField,P=e.filter,S=e.srsName,j=e.style,C=Math.ceil(u/y);return s().createElement(Be,{pagination:{firstPage:1===m,lastPage:C<=m,paginated:!0,loadPrevPage:d,loadNextPage:f,currentPage:m},srsName:S,busy:h,dropUp:!1,data:v,open:t,onChangeDrawingStatus:c,valueField:E,textField:w,itemComponent:b,filter:P,onFocus:n,onToggle:r,onChange:a,onSelect:o,features:g,style:j,selectedValue:i?p:l||p,loading:O})})),Ue=(0,H.compose)((0,H.withPropsOnChange)(["valueField"],(function(){return{value:void 0}})),(0,H.withStateHandlers)((function(e){return{delayDebounce:0,performFetch:!1,open:!1,currentPage:1,maxFeatures:5,changed:e.value,value:e.value,onChangeDrawingStatus:e.onChangeDrawingStatus,itemComponent:e.itemComponent}}),{select:function(){return function(e){return{selected:e}}},change:function(e){return function(t,r){return e.selected||e.open||e.onChangeDrawingStatus("clean","","queryform",[],{}),{delayDebounce:500,selected:!1,changingPage:!1,changed:!0,performFetch:!(e.selected&&!e.changingPage),value:e.selected&&e.changingPage&&e.value||("string"==typeof t?t:t[r]),currentPage:e.changingPage?e.currentPage:1}}},focus:function(e){return function(t){return t&&0===t.length&&""===e.value?{delayDebounce:0,currentPage:1,performFetch:!0,isToggled:!1,open:!0}:e}},toggle:function(e){return function(){return{open:!!e.changingPage||!e.open}}},loadNextPage:function(e){return function(){return{currentPage:e.currentPage+1,performFetch:!0,changingPage:!0,delayDebounce:0}}},loadPrevPage:function(e){return function(){return{currentPage:e.currentPage-1,performFetch:!0,changingPage:!0,delayDebounce:0}}}}),(0,H.withHandlers)({select:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,r=e.onChangeSpatialFilterValue,o=void 0===r?function(){}:r,n=e.select,a=void 0===n?function(){}:n;return function(e,r,n,i){r&&o({geometry:r.geometry,value:e,feature:r,srsName:n,style:i,options:t,collectGeometries:t&&t.crossLayer?{queryCollection:{typeName:t.crossLayer.typeName,geometryName:t.crossLayer.geometryName,cqlFilter:(0,Pe.generateTemplateString)(t.crossLayer.cqlTemplate||"",oe.escapeCQLStrings)(r)}}:void 0}),a(!0)}}})),We=Ue(Ge),ze=r(4201);function Qe(e){return Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qe(e)}function He(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xe(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function $e(e,t){return $e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},$e(e,t)}function Ye(e,t){if(t&&("object"===Qe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Je(e){return Je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Je(e)}var Ke,et,tt,rt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$e(e,t)}(i,e);var t,r,o,n,a=(o=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Je(o);if(n){var r=Je(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ye(this,e)});function i(){return He(this,i),a.apply(this,arguments)}return t=i,(r=[{key:"render",value:function(){return s().createElement("span",{className:this.props.customItemClassName?this.props.customItemClassName:""},this.props.item)}}])&&Xe(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(s().Component);Ke=rt,et="propTypes",tt={item:i().string,textField:i().string,customItemClassName:i().string,valueField:i().string},et in Ke?Object.defineProperty(Ke,et,{value:tt,enumerable:!0,configurable:!0,writable:!0}):Ke[et]=tt;const ot=rt;var nt=r(27418),at=r.n(nt),it=r(86267);function lt(e){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lt(e)}function st(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pt(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ut(e,t){return ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ut(e,t)}function ct(e,t){if(t&&("object"===lt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ft(e)}function ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dt(e){return dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},dt(e)}function yt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var mt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ut(e,t)}(i,e);var t,r,o,n,a=(o=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=dt(o);if(n){var r=dt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return ct(this,e)});function i(){var e;st(this,i);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return yt(ft(e=a.call.apply(a,[this].concat(r))),"onUpdateBBOX",(function(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace";"replace"===o&&(e.tempExtent[r]=!isNaN(parseFloat(t))&&parseFloat(t)||0);var n=[];for(var a in e.tempExtent)a&&n.push(e.tempExtent[a]);var i=(0,it.reprojectBbox)(n,"EPSG:4326",e.props.projection),l={type:e.props.geometry.type,coordinates:[[[i[0],i[1]],[i[0],i[3]],[i[2],i[3]],[i[2],i[1]],[i[0],i[1]]]],projection:e.props.geometry.projection};e.props.onChangeDrawingStatus(o,void 0,"queryform",[l])})),yt(ft(e),"onUpdateCircle",(function(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace";"replace"===o&&(e.tempCircle[r]=parseFloat(t));var n=isNaN(parseFloat(e.tempCircle.x))||isNaN(parseFloat(e.tempCircle.y))?[e.tempCircle.x,e.tempCircle.y]:(0,it.reproject)([e.tempCircle.x,e.tempCircle.y],"EPSG:4326",e.props.projection);n=void 0===n.x?{x:n[0],y:n[1]}:n;var a={x:isNaN(n.x)?0:n.x,y:isNaN(n.y)?0:n.y},i={type:e.props.geometry.type,center:a,coordinates:[a.x,a.y],radius:isNaN(e.tempCircle.radius)?0:e.tempCircle.radius,projection:e.props.geometry.projection};e.props.onChangeDrawingStatus(o,void 0,"queryform",[i],{geodesic:e.props.enableGeodesic})})),yt(ft(e),"onModifyGeometry",(function(){"BBOX"===e.props.type?e.onUpdateBBOX(null,null,"endDrawing"):"Circle"===e.props.type&&e.onUpdateCircle(null,null,"endDrawing"),e.props.onShowPanel(!1)})),yt(ft(e),"onClosePanel",(function(){e.resetGeom(),e.props.onShowPanel(!1)})),yt(ft(e),"getStep",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Math.min(1/Math.pow(10,Math.ceil(Math.min(e,21)/3)-2),1)})),yt(ft(e),"getStepCircle",(function(t,r){var o=e.getStep(t);return"radius"===r&&!e.isWGS84()&&1e4*o||o})),yt(ft(e),"getBBOXDimensions",(function(e){var t=(0,it.reprojectBbox)(e.extent,e.projection,"EPSG:4326");return{west:t[0],sud:t[1],est:t[2],north:t[3]}})),yt(ft(e),"getCircleDimensions",(function(t){var r=(0,it.reproject)(t.center,t.projection,"EPSG:4326"),o=(0,it.reproject)(t.center,t.projection,e.props.projection),n=(0,it.reproject)([t.center[0]+t.radius,t.center[1]],t.projection,e.props.projection),a=Math.sqrt((n.x-o.x)*(n.x-o.x)+(n.y-o.y)*(n.y-o.y));return{x:r.x,y:r.y,radius:a}})),yt(ft(e),"renderCoordinateField",(function(t,r){return s().createElement("div",null,s().createElement("div",{className:"detail-field-title"},r),s().createElement(Fe.Z,{style:{minWidth:"105px",margin:"auto"},type:"number",id:"queryform_bbox_"+r,step:e.getStep(e.props.zoom),defaultValue:e.roundValue(t,1e6),onChange:function(t){return e.onUpdateBBOX(t,r)}}))})),yt(ft(e),"renderCircleField",(function(t,r){return s().createElement(Fe.Z,{type:"number",id:"queryform_circle_"+r,defaultValue:e.roundValue(t,"radius"!==r||e.isWGS84()?1e6:100),step:e.getStepCircle(e.props.zoom,r),onChange:function(t){return e.onUpdateCircle(t,r)}})})),yt(ft(e),"renderDetailsContent",(function(){var t,r=e.props.geometry;if("BBOX"===e.props.type){var o=e.getBBOXDimensions(r);t=s().createElement("div",null,s().createElement("div",{className:"container-fluid"},s().createElement(j.Row,null,s().createElement(j.Col,{xs:4},s().createElement("span",null)),s().createElement(j.Col,{xs:4},e.renderCoordinateField(o.north,"north")),s().createElement(j.Col,{xs:4},s().createElement("span",null))),s().createElement(j.Row,null,s().createElement(j.Col,{xs:4},e.renderCoordinateField(o.west,"west")),s().createElement(j.Col,{xs:4},s().createElement("span",null)),s().createElement(j.Col,{xs:4},e.renderCoordinateField(o.est,"est"))),s().createElement(j.Row,null,s().createElement(j.Col,{xs:4},s().createElement("span",null)),s().createElement(j.Col,{xs:4},e.renderCoordinateField(o.sud,"sud")),s().createElement(j.Col,{xs:4},s().createElement("span",null)))),s().createElement("span",null,s().createElement("hr",{width:"90%"}),s().createElement("div",null,s().createElement("h5",null,s().createElement(ve.ZP.Message,{msgId:"queryform.spatialfilter.details.details_bbox_label"})))))}else if("Circle"===e.props.type){var n=e.getCircleDimensions(r),a=(0,it.getUnits)(e.props.projection);t=s().createElement("div",null,s().createElement("div",{className:"container-fluid"},s().createElement(j.Row,null,s().createElement(j.Col,{xs:2},s().createElement("span",null)),s().createElement(j.Col,{xs:2},s().createElement("span",{className:"details-circle-attribute-name"},"x:")),s().createElement(j.Col,{xs:4},e.renderCircleField(n.x,"x")),s().createElement(j.Col,{xs:4},s().createElement("span",null))),s().createElement(j.Row,null,s().createElement(j.Col,{xs:2},s().createElement("span",null)),s().createElement(j.Col,{xs:2},s().createElement("span",{className:"details-circle-attribute-name"},"y:")),s().createElement(j.Col,{xs:4},e.renderCircleField(n.y,"y")),s().createElement(j.Col,{xs:4},s().createElement("span",null))),s().createElement(j.Row,null,s().createElement(j.Col,{xs:2},s().createElement("span",null)),s().createElement(j.Col,{xs:2},s().createElement("span",{className:"details-circle-attribute-name"},s().createElement(ve.ZP.Message,{msgId:"queryform.spatialfilter.details.radius",msgParams:{unit:"degrees"===a?"Â°":a}}),":")),s().createElement(j.Col,{xs:4},e.renderCircleField(n.radius,"radius")),s().createElement(j.Col,{xs:4},s().createElement("span",null)))),s().createElement("span",null,s().createElement("hr",{width:"90%"}),s().createElement("div",null,s().createElement("h5",null,s().createElement(ve.ZP.Message,{msgId:"queryform.spatialfilter.details.details_circle_label"})))))}return t})),yt(ft(e),"isWGS84",(function(){return"EPSG:4326"===e.props.projection})),yt(ft(e),"roundValue",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e6;return Math.round(e*t)/t})),yt(ft(e),"resetGeom",(function(){"BBOX"===e.props.type?e.resetBBOX():"Circle"===e.props.type&&e.resetCircle()})),yt(ft(e),"resetBBOX",(function(){for(var t in e.extent)t&&(document.getElementById("queryform_bbox_"+t).value=e.roundValue(e.extent[t],1e6),e.onUpdateBBOX(e.extent[t],t))})),yt(ft(e),"resetCircle",(function(){document.getElementById("queryform_circle_radius").value=e.roundValue(e.circle.radius,100),e.onUpdateCircle(e.circle.radius,"radius"),document.getElementById("queryform_circle_x").value=e.roundValue(e.circle.x,e.isWGS84()?1e6:100),e.onUpdateCircle(e.circle.x,"x"),document.getElementById("queryform_circle_y").value=e.roundValue(e.circle.y,e.isWGS84()?1e6:100),e.onUpdateCircle(e.circle.y,"y")})),e}return t=i,(r=[{key:"componentDidMount",value:function(){var e=this.props.geometry;"BBOX"===this.props.type?(this.extent=this.getBBOXDimensions(e),this.tempExtent=at()({},this.extent)):"Circle"===this.props.type&&(this.circle=this.getCircleDimensions(e),this.tempCircle=at()({},this.circle))}},{key:"render",value:function(){var e=this;return s().createElement(S.Z,{buttons:[{key:"confirm",glyph:"ok",tooltipId:"confirm",onClick:function(){return e.onModifyGeometry()}},{key:"reset",tooltipId:"queryform.reset",glyph:"clear-filter",onClick:function(){return e.resetGeom()}},{key:"close",glyph:"1-close",onClick:function(){return e.onClosePanel(!1)}}],title:s().createElement(ve.ZP.Message,{msgId:"queryform.spatialfilter.details.details_header"}),locked:!0,expanded:!0,className:"details-panel",bsStyle:"primary"},this.renderDetailsContent())}}])&&pt(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(s().Component);yt(mt,"propTypes",{useMapProjection:i().bool,geometry:i().object,type:i().string,onShowPanel:i().func,onChangeDrawingStatus:i().func,zoom:i().number,projection:i().string,enableGeodesic:i().bool}),yt(mt,"defaultProps",{useMapProjection:!0,geometry:null,type:null,onShowPanel:function(){},onChangeDrawingStatus:function(){}});const bt=mt;function gt(e){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gt(e)}function ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vt(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ft(e,t){return Ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ft(e,t)}function Ot(e,t){if(t&&("object"===gt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Et(e)}function Et(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wt(e){return wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},wt(e)}function Pt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var St=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ft(e,t)}(l,e);var t,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=wt(o);if(a){var r=wt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ot(this,e)});function l(){var e;ht(this,l);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return Pt(Et(e=i.call.apply(i,[this].concat(r))),"state",{open:!1}),Pt(Et(e),"getFilter",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"=",o={filterFields:[{attribute:e.props.searchAttribute,operator:r,value:t,type:"list"}]};e.props.dependsOn&&(o.groupFields=[{id:1,logic:"AND",index:0}],o.filterFields[0].groupId=1,e.props.multivalue?(o.groupFields.push({id:2,logic:"OR",groupId:1,index:1}),e.props.dependsOn.value instanceof Array?e.props.dependsOn.value.forEach((function(t){o.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:t,groupId:2,type:"list"})})):o.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:e.props.dependsOn.value,groupId:2,type:"list"})):o.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:e.props.dependsOn.value,groupId:1,type:"list"}));var n=(0,oe.toOGCFilter)(e.props.typeName,o,e.props.wfs,e.props.sort||{sortBy:e.props.searchAttribute,sortOrder:"ASC"});return n})),Pt(Et(e),"changeZoneValue",(function(t,r,o){var n;e.setState({open:!1}),n=e.props.multivalue?{value:o.map((function(e){return e.id})),feature:o.map((function(e){return e.feature}))}:{value:[o],feature:[e.values.filter((function(e){return e.id===o}))[0].feature]},e.props.onChange(e.props.zoneId,n)})),e}return t=l,(r=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.values&&!n()(this.props.values,e.values)&&e.values.length>0&&this.setState({open:!0})}},{key:"render",value:function(){var e=this;this.values=[],this.props.values&&this.props.values.length>0&&(this.values=this.props.values.map((function(t){var r=t;e.props.valueField.split(".").forEach((function(e){r=r?r[e]:null}));var o=t;return e.props.textField.split(".").forEach((function(e){o=o?o[e]:null})),{id:r,name:o,feature:t}})));var t=this.props.label?s().createElement("label",null,this.props.label):s().createElement("span",null),r=this.props.error;return r&&(r="object"!==gt(r)?r:r.status+" "+r.statusText+": "+r.data),s().createElement("div",{className:"zone-combo"},t,s().createElement(ze.Z,{key:(new Date).getTime(),busy:this.props.busy,disabled:this.props.disabled,fieldRowId:this.props.zoneId,valueField:"id",textField:"name",fieldOptions:this.values,fieldValue:this.props.value,fieldName:"zone",fieldException:r,options:{defaultOpen:this.state.open},groupBy:this.props.groupBy?function(t){return t.feature.properties[e.props.groupBy]}:function(){},multivalue:this.props.multivalue,comboFilter:this.props.comboFilter,onSelect:this.props.onSelect,onUpdateField:this.changeZoneValue,onToggle:function(t){if(t&&(!e.props.values||e.props.values.length<1)){var r=e.getFilter(e.props.searchText,e.props.searchMethod);e.props.onSearch(!0,e.props.zoneId),e.props.onFilter(e.props.url,r,e.props.zoneId)}}}))}}])&&vt(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(s().Component);Pt(St,"propTypes",{zoneId:i().number,url:i().string,typeName:i().string,wfs:i().string,busy:i().bool,values:i().array,value:i().oneOfType([i().object,i().number,i().string,i().array]),label:i().string,searchText:i().string,searchMethod:i().string,searchAttribute:i().string,sort:i().object,error:i().oneOfType([i().object,i().string]),comboFilter:i().oneOfType([i().bool,i().string,i().func]),groupBy:i().oneOfType([i().string,i().func]),multivalue:i().bool,open:i().bool,disabled:i().bool,dependsOn:i().object,valueField:i().string,textField:i().string,onSearch:i().func,onFilter:i().func,onChange:i().func,onSelect:i().func}),Pt(St,"contextTypes",{messages:i().object}),Pt(St,"defaultProps",{open:!1,zoneId:null,url:null,typeName:null,wfs:"1.1.0",busy:!1,values:[],value:null,valueField:null,textField:null,label:null,disabled:!1,error:null,searchText:"*",searchMethod:"ilike",searchAttribute:null,comboFilter:"contains",multivalue:!0,groupBy:null,onSearch:function(){},onFilter:function(){},onChange:function(){},onSelect:function(){}});const jt=St;function Ct(e){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ct(e)}function xt(){return xt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},xt.apply(this,arguments)}function Tt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qt(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Nt(e,t){return Nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Nt(e,t)}function Dt(e,t){if(t&&("object"===Ct(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return It(e)}function It(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lt(e){return Lt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Lt(e)}function _t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Mt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Nt(e,t)}(i,e);var t,r,o,n,a=(o=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Lt(o);if(n){var r=Lt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Dt(this,e)});function i(){var e;Tt(this,i);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return _t(It(e=a.call.apply(a,[this].concat(r))),"getMethodFromId",(function(t){return Z()(e.props.spatialMethodOptions,(function(e){return e&&e.id===t}))||null})),_t(It(e),"renderHeader",(function(){var t=(0,he.S$)(e.context.messages,"queryform.spatialfilter.spatial_filter_header");return s().createElement("span",null,s().createElement("span",{style:{cursor:"pointer"},onClick:e.props.actions.onExpandSpatialFilterPanel.bind(null,!e.props.spatialPanelExpanded)},t),s().createElement("button",{onClick:e.props.actions.onExpandSpatialFilterPanel.bind(null,!e.props.spatialPanelExpanded),className:"close"},e.props.spatialPanelExpanded?s().createElement(j.Glyphicon,{glyph:"glyphicon glyphicon-collapse-down"}):s().createElement(j.Glyphicon,{glyph:"glyphicon glyphicon-expand"})))})),_t(It(e),"renderSpatialHeader",(function(){var t=e.getMethodFromId(e.props.spatialField.method);return s().createElement("div",null,s().createElement(j.Row,{className:"logicHeader inline-form filter-field-row filter-field-fixed-row"},s().createElement(j.Col,{xs:6},s().createElement("div",null,s().createElement(ve.ZP.Message,{msgId:"queryform.spatialfilter.filterType"}))),s().createElement(j.Col,{xs:6},s().createElement(ze.Z,{itemComponent:function(t){return s().createElement(ot,xt({customItemClassName:e.getMethodFromId(t.item)&&e.getMethodFromId(t.item).customItemClassName||""},t))},fieldOptions:e.props.spatialMethodOptions.map((function(t){return(0,he.S$)(e.context.messages,t.name)||t.name})),placeholder:(0,he.S$)(e.context.messages,"queryform.spatialfilter.combo_placeholder"),fieldName:"method",fieldRowId:(new Date).getTime(),fieldValue:(0,he.S$)(e.context.messages,t?t.name:"")||t&&t.name||"",onUpdateField:e.updateSpatialMethod}))))})),_t(It(e),"renderDwithin",(function(){return s().createElement(j.Row,{className:"container-fluid filter-field-fixed-row"},s().createElement(j.Col,{xs:6,className:"filter-text-desc"},s().createElement(ve.ZP.Message,{msgId:"queryform.spatialfilter.dwithin_label"})),s().createElement(j.Col,{xs:6},s().createElement(Fe.Z,{type:"number",min:"0",defaultValue:"0",disabled:!e.props.spatialField.geometry,id:"queryform_dwithin_field",onChange:function(t){return e.props.actions.onChangeDwithinValue(t,name)}})))})),_t(It(e),"renderZoneFields",(function(){return e.props.spatialField.method&&"ZONE"===e.props.spatialField.method&&e.props.spatialField.zoneFields&&e.props.spatialField.zoneFields.length>0?e.props.spatialField.zoneFields.map((function(t){return s().createElement(jt,{key:t.id,open:t.open,zoneId:t.id,url:t.url,typeName:t.typeName,wfs:t.wfs,busy:t.busy,label:t.label,values:t.values,value:t.value,valueField:t.valueField,textField:t.textField,searchText:t.searchText,searchMethod:t.searchMethod,searchAttribute:t.searchAttribute,sort:t.sort,error:t.error,disabled:t.disabled,dependsOn:t.dependson,groupBy:t.groupBy,multivalue:t.multivalue,onSearch:e.props.actions.zoneSearch,onFilter:e.props.actions.zoneFilter,onChange:e.props.actions.zoneChange})})):null})),_t(It(e),"renderRoiPanel",(function(){var t=e.getMethodFromId(e.props.spatialField.method),r=t&&t.filterProps&&t.filterProps.valueField&&e.props.spatialField&&e.props.spatialField.value&&e.props.spatialField.value[t.filterProps.valueField];return s().createElement(j.Panel,null,s().createElement("div",{className:"container-fluid"},s().createElement(j.Row,{className:"filter-field-row filter-field-fixed-row"},s().createElement(j.Col,{xs:6},s().createElement("span",null,t&&t.name||t.id)),s().createElement(j.Col,{xs:6},s().createElement(We,{originalValue:r,key:e.props.spatialField.method,options:t,autocompleteStreamFactory:ge.Vj,valueField:t&&t.filterProps&&t.filterProps.valueField,textField:t&&t.filterProps&&t.filterProps.valueField,url:t&&t.url,filter:"contains",onChangeSpatialFilterValue:e.props.actions.onChangeSpatialFilterValue,onChangeDrawingStatus:function(){var t;(t=e.props.actions).onChangeDrawingStatus.apply(t,arguments)},filterProps:t&&t.filterProps})))))})),_t(It(e),"renderSpatialPanel",(function(t,r,o){return s().createElement(j.Panel,{className:"spatial-panel"},e.props.spatialMethodOptions.length>1?e.renderSpatialHeader():s().createElement("span",null),e.renderZoneFields(),e.props.spatialField.method&&e.getMethodFromId(e.props.spatialField.method)&&"wfsGeocoder"===e.getMethodFromId(e.props.spatialField.method).type?e.renderRoiPanel():null,e.props.spatialOperations.length>1?s().createElement(j.Panel,null,s().createElement("div",null,t),o&&"DWITHIN"===o.id?e.renderDwithin():null,s().createElement(j.Row,null,s().createElement(j.Col,{xs:12},r))):s().createElement("span",null))})),_t(It(e),"renderButtons",(function(){var t=[],r=e.props.showDetailsButton&&e.props.spatialField.geometry&&(e.props.spatialField.method&&"BBOX"===e.props.spatialField.method||"Circle"===e.props.spatialField.method),o=e.props.spatialField.geometry&&e.props.spatialField.geometry.coordinates;return r&&t.push({glyph:"pencil",onClick:function(){return e.props.actions.onShowSpatialSelectionDetails(!0)},tooltipId:"queryform.spatialfilter.details.detail_button_label"}),o&&t.push({glyph:"clear-filter",tooltipId:"queryform.spatialfilter.remove",bsStyle:e.props.clearFilterOptions.buttonStyle,className:e.props.clearFilterOptions.className,onClick:function(){return e.resetSpatialFilter()}}),t})),_t(It(e),"updateSpatialMethod",(function(t,r,o){e.props.actions.onShowSpatialSelectionDetails(!1);var n=e.props.spatialMethodOptions.filter((function(t){return o===((0,he.S$)(e.context.messages,t.name)||t.name)}))[0].id,a=e.getMethodFromId(n);if(e.props.actions.onSelectSpatialMethod(n,r),"wfsGeocoder"!==e.getMethodFromId(n).type)switch(n){case"ZONE":e.changeDrawingStatus("clean","","queryform",[]);break;case"Viewport":e.changeDrawingStatus("clean","","queryform",[]),e.props.actions.onSelectViewportSpatialMethod();break;default:e.changeDrawingStatus("start",n,"queryform",[],{geodesic:!!be()(a.geodesic)||a.geodesic,stopAfterDrawing:!0})}else e.changeDrawingStatus("clean","","queryform",[])})),_t(It(e),"updateSpatialOperation",(function(t,r,o){var n=e.props.spatialOperations.filter((function(t){return o===(0,he.S$)(e.context.messages,t.name)}))[0].id;e.props.actions.onSelectSpatialOperation(n,r)})),_t(It(e),"resetSpatialFilter",(function(){e.changeDrawingStatus("clean","","queryform",[]),e.props.actions.onRemoveSpatialSelection(),e.props.actions.onShowSpatialSelectionDetails(!1)})),_t(It(e),"changeDrawingStatus",(function(t,r,o,n,a){e.props.actions.onChangeDrawingStatus(t,void 0!==r?r:e.props.spatialField.method,o,n,a)})),e}return t=i,(r=[{key:"render",value:function(){var e=this,t=this.props.spatialOperations.filter((function(t){return e.props.spatialField.operation===t.id}))[0],r=s().createElement("span",null);"ZONE"!==this.props.spatialField.method&&"Viewport"!==this.props.spatialField.method&&this.getMethodFromId(this.props.spatialField.method)&&"wfsGeocoder"!==this.getMethodFromId(this.props.spatialField.method).type&&(r=this.props.spatialField.geometry?null:s().createElement("span",null,s().createElement("div",{className:"m-label m-caption text-center"},s().createElement(ve.ZP.Message,{msgId:"queryform.spatialfilter.draw_start_label"}))));var o=this.getMethodFromId(this.props.spatialField.method),n=this.props.showDetailsPanel?s().createElement(bt,{useMapProjection:this.props.useMapProjection,enableGeodesic:!!be()(o.geodesic)||o.geodesic,geometry:this.props.spatialField.geometry,type:this.props.spatialField.method,onShowPanel:this.props.actions.onShowSpatialSelectionDetails,onChangeDrawingStatus:this.changeDrawingStatus,zoom:this.props.zoom,projection:this.props.projection}):s().createElement("span",null),a=s().createElement(j.Row,{className:"filter-field-row inline-form filter-field-fixed-row"},s().createElement(j.Col,{xs:6},s().createElement(ve.ZP.Message,{msgId:"queryform.spatialfilter.geometric_operation"})),s().createElement(j.Col,{xs:6},s().createElement(ze.Z,{fieldOptions:this.props.spatialOperations.map((function(t){return(0,he.S$)(e.context.messages,t.name)})),fieldName:"operation",fieldRowId:(new Date).getTime(),fieldValue:(0,he.S$)(this.context.messages,t?t.name:""),onUpdateField:this.updateSpatialOperation})));return s().createElement("div",{className:"query-filter-container"},this.props.withContainer?s().createElement(S.Z,{id:"spatialFilterPanel",header:this.renderHeader(),buttons:this.renderButtons(),collapsible:!0,expanded:this.props.spatialPanelExpanded,onSwitch:function(t){return e.props.actions.onExpandSpatialFilterPanel(t)}},this.renderSpatialPanel(a,r,t)):this.renderSpatialPanel(a,r,t),n)}}])&&qt(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(s().Component);_t(Mt,"propTypes",{useMapProjection:i().bool,spatialField:i().object,spatialOperations:i().array,spatialMethodOptions:i().array,spatialPanelExpanded:i().bool,showDetailsButton:i().bool,clearFilterOptions:i().object,showDetailsPanel:i().bool,withContainer:i().bool,actions:i().object,zoom:i().number,projection:i().string}),_t(Mt,"contextTypes",{messages:i().object}),_t(Mt,"defaultProps",{useMapProjection:!0,spatialField:{},spatialPanelExpanded:!0,showDetailsButton:!0,clearFilterOptions:{className:"square-button-sm no-border",buttonStyle:"default"},showDetailsPanel:!1,withContainer:!0,spatialMethodOptions:[],spatialOperations:[],actions:{onExpandSpatialFilterPanel:function(){},onSelectSpatialMethod:function(){},onSelectSpatialOperation:function(){},onChangeSpatialFilterValue:function(){},onChangeDrawingStatus:function(){},onRemoveSpatialSelection:function(){},onShowSpatialSelectionDetails:function(){},onSelectViewportSpatialMethod:function(){},onChangeRegion:function(){},onChangeDwithinValue:function(){},zoneFilter:function(){},zoneSearch:function(){},zoneChange:function(){}}});const Rt=Mt;function kt(){return kt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},kt.apply(this,arguments)}var Bt=(0,r(17252).Z)((function(e){return s().createElement("div",kt({className:"square-button pull-right no-border",style:{display:"flex"}},e),s().createElement(j.Glyphicon,{glyph:"exclamation-mark",className:"text-danger"}))}));const At=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.loadingError,r=e.onToggleQuery,o=void 0===r?function(){}:r,n=e.buttonStyle,a=void 0===n?"default":n;return s().createElement("div",{className:"mapstore-block-width"},s().createElement(ne.Z,{id:"toc-query-close-button",key:"menu-button",className:"square-button no-border",bsStyle:a,onClick:function(){return o()}},s().createElement(j.Glyphicon,{glyph:"arrow-left"})),t&&s().createElement(Bt,{popover:{text:s().createElement(P.Z,{msgId:"queryform.loadingError"})}})||s().createElement("div",{className:"square-button pull-right no-border",style:{display:"flex"}},s().createElement(j.Glyphicon,{glyph:"filter",className:"text-primary"})))};function Zt(e){return Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zt(e)}function Vt(){return Vt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},Vt.apply(this,arguments)}function Gt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ut(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Wt(e,t){return Wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Wt(e,t)}function zt(e,t){if(t&&("object"===Zt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Qt(e){return Qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Qt(e)}function Ht(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Xt=te((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.crossLayerExpanded,r=void 0===t||t,o=e.spatialOperations,n=e.expandCrossLayerFilterPanel,a=void 0===n?function(){}:n,i=e.layers,l=void 0===i?[]:i,p=e.errorObj,u=e.loadingAttributes,c=e.loadingCapabilities,f=e.searchUrl,d=e.queryCollection,y=void 0===d?{}:d,m=e.attributes,b=void 0===m?[]:m,g=e.operation,h=e.updateLogicCombo,v=void 0===h?function(){}:h,F=e.resetCrossLayerFilter,O=void 0===F?function(){}:F,E=e.setOperation,w=void 0===E?function(){}:E,x=e.setQueryCollectionParameter,T=void 0===x?function(){}:x,D=e.addCrossLayerFilterField,_=void 0===D?function(){}:D,k=e.updateCrossLayerFilterField,B=void 0===k?function(){}:k,A=e.removeCrossLayerFilterField,Z=void 0===A?function(){}:A,V=y.typeName,G=y.geometryName,U=y.filterFields,W=y.groupFields,z=void 0===W?[{id:1,logic:"OR",index:0}]:W,Q=l.filter((function(e){return!M(f,e)})),H=function(){return l.length&&Q.length?s().createElement(I.Z,{bsStyle:"link",text:s().createElement(P.Z,{msgId:"queryform.crossLayerFilter.errors.layersExcluded"})}):null};return s().createElement(S.Z,{loading:c,expanded:r&&!c&&!p,error:p,errorMsgId:"queryPanel",buttons:L(V?[{glyph:"clear-filter",tooltipId:"queryform.crossLayerFilter.clear",onClick:function(){return O()}}]:[]),onSwitch:a,title:s().createElement(P.Z,{msgId:"queryform.crossLayerFilter.title"})},s().createElement(j.Row,{className:"inline-form filter-field-fixed-row"},s().createElement(j.Col,{xs:6},s().createElement("div",null,s().createElement(P.Z,{msgId:"queryform.crossLayerFilter.targetLayer"}),"Â ",H())),s().createElement(j.Col,{xs:6},s().createElement(C.ZP,{clearable:!1,disabled:c||!!p,isLoading:u,options:l.filter((function(e){return M(f,e)})).map((function(e){return{label:e.title||e.name,value:e.name}})),placeholder:s().createElement(P.Z,{msgId:"queryform.crossLayerFilter.placeholder"}),filter:"contains",value:V,onChange:function(e){T("typeName",e&&e.value)}}))),V&&G?s().createElement(j.Row,{className:"inline-form filter-field-fixed-row"},s().createElement(j.Col,{xs:6},s().createElement("div",null,s().createElement(P.Z,{msgId:"queryform.crossLayerFilter.operation"}))),s().createElement(j.Col,{xs:6},s().createElement(q,{value:g,onChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return w(t)},spatialOperations:R(o)}))):null,V&&G&&g?s().createElement(j.Row,{className:"filter-field-fixed-row"},s().createElement(j.Col,{xs:12},s().createElement(N.Z,{autocompleteEnabled:!1,withContainer:!1,attributes:b,groupLevels:-1,filterFields:U,actions:{onUpdateLogicCombo:v,onAddFilterField:_,onUpdateFilterField:B,onRemoveFilterField:Z},groupFields:z,filterField:!0}))):null)})),$t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Wt(e,t)}(i,e);var t,r,o,n,a=(o=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Qt(o);if(n){var r=Qt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return zt(this,e)});function i(){return Gt(this,i),a.apply(this,arguments)}return t=i,(r=[{key:"render",value:function(){if(""!==this.props.featureTypeError)return s().createElement("div",null,s().createElement(At,{onToggleQuery:this.props.controlActions.onToggleQuery}),s().createElement("div",{style:{margin:"0 auto","text-align":"center"}},this.props.featureTypeErrorText));var e=s().createElement("div",{className:"m-header"},this.props.header,s().createElement(ye,{sendFilters:{attributeFilter:this.props.attributePanelExpanded,spatialFilter:this.props.spatialPanelExpanded,crossLayerFilter:this.props.crossLayerExpanded},params:this.props.params,filterFields:this.props.filterFields,groupFields:this.props.groupFields,spatialField:this.props.spatialField,toolbarEnabled:this.props.toolbarEnabled,searchUrl:this.props.searchUrl,showGeneratedFilter:this.props.showGeneratedFilter,featureTypeName:this.props.featureTypeName,ogcVersion:this.props.ogcVersion,filterType:this.props.filterType,actions:this.props.queryToolbarActions,resultTitle:this.props.resultTitle,pagination:this.props.pagination,sortOptions:this.props.sortOptions,crossLayerFilter:this.props.crossLayerFilterOptions.crossLayerFilter,hits:this.props.hits,allowEmptyFilter:this.props.allowEmptyFilter,emptyFilterWarning:this.props.emptyFilterWarning,appliedFilter:this.props.appliedFilter,storedFilter:this.props.storedFilter,advancedToolbar:this.props.advancedToolbar,loadingError:this.props.loadingError}));return this.props.attributes.length>0?s().createElement(w.Z,{header:e,className:"mapstore-query-builder",id:"query-form-panel"},s().createElement(N.Z,{buttonStyle:this.props.buttonStyle,removeGroupButtonIcon:this.props.removeGroupButtonIcon,autocompleteEnabled:this.props.autocompleteEnabled,maxFeaturesWPS:this.props.maxFeaturesWPS,attributes:this.props.attributes,groupLevels:this.props.groupLevels,filterFields:this.props.filterFields,groupFields:this.props.groupFields,removeButtonIcon:this.props.removeButtonIcon,addButtonIcon:this.props.addButtonIcon,attributePanelExpanded:this.props.attributePanelExpanded,actions:this.props.attributeFilterActions}),this.props.toolsOptions.hideSpatialFilter?null:s().createElement(Rt,{useMapProjection:this.props.useMapProjection,spatialField:this.props.spatialField,clearFilterOptions:this.props.clearFilterOptions,spatialOperations:this.props.spatialOperations,spatialMethodOptions:this.props.spatialMethodOptions,showDetailsButton:this.props.showDetailsButton,spatialPanelExpanded:this.props.spatialPanelExpanded,showDetailsPanel:this.props.showDetailsPanel,actions:this.props.spatialFilterActions,zoom:this.props.zoom,projection:this.props.projection}),this.props.toolsOptions.hideCrossLayer?null:s().createElement(Xt,Vt({spatialOperations:this.props.spatialOperations,crossLayerExpanded:this.props.crossLayerExpanded,searchUrl:this.props.searchUrl,featureTypeName:this.props.featureTypeName},this.props.crossLayerFilterOptions,this.props.crossLayerFilterActions))):s().createElement("div",{style:{margin:"0 auto",width:"60px"}},s().createElement(E(),{spinnerName:"three-bounce",overrideSpinnerClassName:"spinner"}))}}])&&Ut(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(s().Component);Ht($t,"propTypes",{params:i().object,featureTypeConfigUrl:i().string,useMapProjection:i().bool,attributes:i().array,featureTypeError:i().string,featureTypeErrorText:i().node,groupLevels:i().number,maxFeaturesWPS:i().number,filterFields:i().array,groupFields:i().array,spatialField:i().object,removeButtonIcon:i().string,addButtonIcon:i().string,attributePanelExpanded:i().bool,showDetailsButton:i().bool,spatialPanelExpanded:i().bool,crossLayerExpanded:i().bool,showDetailsPanel:i().bool,toolbarEnabled:i().bool,searchUrl:i().string,showGeneratedFilter:i().oneOfType([i().bool,i().string]),filterType:i().string,featureTypeName:i().string,ogcVersion:i().string,attributeFilterActions:i().object,spatialFilterActions:i().object,queryToolbarActions:i().object,resultTitle:i().string,pagination:i().object,sortOptions:i().object,spatialOperations:i().array,spatialMethodOptions:i().array,crossLayerFilterOptions:i().object,crossLayerFilterActions:i().object,hits:i().bool,clearFilterOptions:i().object,buttonStyle:i().string,removeGroupButtonIcon:i().string,maxHeight:i().number,allowEmptyFilter:i().bool,autocompleteEnabled:i().bool,emptyFilterWarning:i().bool,header:i().node,zoom:i().number,projection:i().string,toolsOptions:i().object,appliedFilter:i().object,storedFilter:i().object,advancedToolbar:i().bool,loadingError:i().bool,controlActions:i().object}),Ht($t,"defaultProps",{params:{},featureTypeConfigUrl:null,useMapProjection:!0,groupLevels:1,buttonStyle:"default",removeGroupButtonIcon:"trash",groupFields:[],filterFields:[],attributes:[],spatialMethodOptions:[],spatialOperations:[],featureTypeError:"",spatialField:{},crossLayerFilter:null,removeButtonIcon:"trash",addButtonIcon:"glyphicon glyphicon-plus",attributePanelExpanded:!0,spatialPanelExpanded:!0,showDetailsPanel:!1,toolbarEnabled:!0,searchUrl:"",showGeneratedFilter:!1,featureTypeName:null,pagination:null,sortOptions:null,hits:!1,maxHeight:830,allowEmptyFilter:!1,autocompleteEnabled:!0,emptyFilterWarning:!1,advancedToolbar:!1,loadingError:!1,attributeFilterActions:{onAddGroupField:function(){},onAddFilterField:function(){},onRemoveFilterField:function(){},onUpdateFilterField:function(){},onUpdateExceptionField:function(){},onUpdateLogicCombo:function(){},onRemoveGroupField:function(){},onChangeCascadingValue:function(){},onExpandAttributeFilterPanel:function(){}},spatialFilterActions:{onExpandSpatialFilterPanel:function(){},onSelectSpatialMethod:function(){},onSelectSpatialOperation:function(){},onChangeDrawingStatus:function(){},onRemoveSpatialSelection:function(){},onShowSpatialSelectionDetails:function(){},onSelectViewportSpatialMethod:function(){},onChangeDwithinValue:function(){}},crossLayerFilterOptions:{},crossLayerFilterActions:{},queryToolbarActions:{onQuery:function(){},onReset:function(){},onChangeDrawingStatus:function(){},onSaveFilter:function(){},onRestoreFilter:function(){}},toolsOptions:{},controlActions:{onToggleQuery:function(){}}});const Yt=$t;var Jt=r(99534),Kt=r(94745),er=r(10240),tr=r.n(er),rr=r(75875),or=r.n(rr),nr=r(97395),ar=r(84069),ir=r(37275),lr=r(24260),sr=r(69842),pr=r(88113);const ur={isAutoCompleteEnabled:function(e,t){return e.ofType(F.S0).switchMap((function(e){var r=(0,ir.y9)(e.url,{version:"1.0.0",REQUEST:"DescribeProcess",IDENTIFIER:"gs:PagedUnique"},(0,pr.kS)(t.getState()));return null===r?G().Observable.of((0,v.NV)(!1)):G().Observable.fromPromise(or().post(r,null,{timeout:5e3,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((function(e){return e.data}))).switchMap((function(e){return tr()(e,"<ows:ExceptionReport")?G().Observable.of((0,v.NV)(!1)):G().Observable.of((0,v.NV)(!0))})).catch((function(){return G().Observable.of((0,v.NV)(!1))}))}))},fetchAutocompleteOptionsEpic:function(e,t){return e.ofType(v.l1).debounce((function(e){return G().Observable.timer(e.fieldOptions.delayDebounce||0)})).filter((function(e){return"value"===e.fieldName&&"string"===e.fieldType&&t.getState().queryform.autocompleteEnabled})).switchMap((function(e){var r=t.getState(),o=(0,sr.Vx)(r),n=r.queryform&&r.queryform.filterFields&&r.queryform.filterFields.filter((function(t){return t.rowId===e.rowId}))[0];if("selected"===e.fieldOptions.selected)return G().Observable.from([(0,v.$J)(n,[],0)]);var a=(0,ar.getWpsPayload)({attribute:n.attribute,layerName:(0,lr.HY)(r),layerFilter:(0,sr.Vc)(r)||(0,sr.hI)(r),maxFeatures:o,startIndex:(e.fieldOptions.currentPage-1)*o,value:e.fieldValue}),i=(0,ir.y9)(r.query.url,{outputFormat:"json"},(0,pr.kS)(t.getState()));return null===i?G().Observable.of((0,v.NV)(!1)):G().Observable.fromPromise(or().post(i,a,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((function(e){return e.data}))).switchMap((function(t){var r=Ee()(t.values)?t.values:[t.values],o=t.size;return G().Observable.from([(0,v.$J)(n,r,o),(0,v.js)(e.rowId,!0)])})).startWith((0,v.jR)(!0,n)).catch((function(){return G().Observable.from([(0,v.$J)(n,[],0),(0,nr.vU)({title:"warning",message:"warning",action:{label:"warning"},autoDismiss:3,position:"tr"}),(0,v.js)(e.rowId,!0)])})).concat([(0,v.jR)(!1,n)])}))}};var cr=r(75982),fr=r(75110);function dr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function yr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dr(Object(r),!0).forEach((function(t){mr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function mr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const br={handleLayerFilterPanel:function(e,t){var r=t.getState;return e.ofType(b.Xs).switchMap((function(){var t=(0,fr.Iz)(r()),o=t||{},n=o.url,a=o.name,i=o.layerFilter,l=t&&t.search&&t.search.url;return G().Observable.of((0,F.gT)(l||n,a),(0,v.F)(i),(0,b.HH)(i),(0,d.Xg)("queryPanel","enabled",!0)).merge(G().Observable.of((0,F.jG)()).filter((function(){return!B()(r(),"query.isLayerFilter")})),e.ofType(v.Wm).switchMap((function(e){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.crossLayerFilter,r=e.spatialField,o=e.filterFields;return!!(o&&je()(o)||r&&r.method&&r.operation&&r.geometry||t&&t.collectGeometries&&t.operation)}(e.filterObj)?yr({},B()(r(),"queryform",{})):void 0;return o&&(o.filterFields=o.attributePanelExpanded&&o.filterFields||[],o.spatialField=o.spatialPanelExpanded&&o.spatialField||null,o.crossLayerFilter=o.crossLayerExpanded&&(0,oe.setupCrossLayerFilterDefaults)(o.crossLayerFilter)||null),G().Observable.of(function(e,t){return(0,g.He)(e,{layerFilter:t})}(t.id,o))}))).let(function(e){return function(t){return t.takeUntil(e.ofType(d.kM).filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.control,r=e.property;return"queryPanel"===t&&(!r||"enabled"===r)})).merge(e.ofType(cr.nk)))}}(e)).concat(G().Observable.from([(0,F.jG)(),(0,v.mc)(),(0,y.Yf)("clean","","queryform",[],{})]))}))},restoreSavedFilter:function(e,t){var r=t.getState;return e.ofType(b.H1).switchMap((function(){var e={typeName:B()(r(),"state.query.typeName")},t=B()(r(),"state.query.url"),o=B()(r(),"layerFilter.persisted");return G().Observable.of((0,y.Yf)("clean","","queryform",[]),(0,v.F)(o),(0,v.yC)(t,o,e),(0,F.Xc)())}))},onApplyFilter:function(e,t){var r=t.getState;return e.ofType(b.MY).map((function(){var e=yr({},B()(r(),"queryform",{}));return(0,b.Xr)(e)}))}};var gr=r(13292),hr=r.n(gr);const vr={updateSpatialFilterValue:function(e){return e.ofType(v.Wi).switchMap((function(e){var t=e.feature,r=e.srsName,o=e.style,n=e.options;return V.Observable.of((0,y.Yf)("drawOrEdit",t.geometry.type,"queryform",[t],{editEnabled:!1,stopAfterDrawing:!0,featureProjection:r},o)).concat(t&&n&&n.autoZoom?[(0,h.Px)(hr()(t),r)]:[])}))}};var Fr=r(827),Or=r(72500),Er=r(31255),wr=r(85148);function Pr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Sr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Pr(Object(r),!0).forEach((function(t){jr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function jr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Cr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function xr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(r),!0).forEach((function(t){Tr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Tr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qr(e){return qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qr(e)}var Nr=function(e){return{geometry:e.featureTypes[0].properties.filter((function(e){return 0===e.type.indexOf("gml:")})).map((function(e){return{label:e.name,attribute:e.name,type:"geometry",valueId:"id",valueLabel:"name",values:[]}})),original:e,attributes:Q(e)}};function Dr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Ir(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Dr(Object(r),!0).forEach((function(t){Lr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Lr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _r={};var Mr=r(97301),Rr=r(46905),kr=r(67306),Br=r(55105),Ar=r(24262),Zr=r(81756);function Vr(e){return Vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vr(e)}function Gr(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ur(e,t){return Ur=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ur(e,t)}function Wr(e,t){if(t&&("object"===Vr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return zr(e)}function zr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qr(e){return Qr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Qr(e)}function Hr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Xr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Hr(Object(r),!0).forEach((function(t){$r(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Yr=v.mc.bind(null,"query"),Jr=(0,p.connect)((function(e){return{useMapProjection:e.queryform.useMapProjection,groupLevels:e.queryform.groupLevels,groupFields:e.queryform.groupFields,filterFields:e.queryform.filterFields,attributes:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes,featureTypeError:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].error,spatialField:e.queryform.spatialField,showDetailsPanel:e.queryform.showDetailsPanel,toolbarEnabled:e.queryform.toolbarEnabled,attributePanelExpanded:e.queryform.attributePanelExpanded,autocompleteEnabled:e.queryform.autocompleteEnabled,crossLayerExpanded:e.queryform.crossLayerExpanded,crossLayerFilterOptions:Xr({layers:(0,sr.GK)(e),crossLayerFilter:(0,sr.qh)(e)},e.queryform.crossLayerFilterOptions||{}),maxFeaturesWPS:e.queryform.maxFeaturesWPS,spatialPanelExpanded:e.queryform.spatialPanelExpanded,featureTypeConfigUrl:e.query&&e.query.url,searchUrl:e.query&&e.query.url,featureTypeName:e.query&&e.query.typeName,ogcVersion:"1.1.0",params:{typeName:e.query&&e.query.typeName},resultTitle:"Query Result",showGeneratedFilter:!1,allowEmptyFilter:!0,emptyFilterWarning:!0,maxHeight:e.map&&e.map.present&&e.map.present.size&&e.map.present.size.height,zoom:((0,Fr.Od)(e)||{}).zoom,projection:((0,Fr.Od)(e)||{}).projection}}),(function(e){return{attributeFilterActions:(0,c.DE)({onAddGroupField:v.kQ,onAddFilterField:v.jW,onRemoveFilterField:v.JG,onUpdateFilterField:v.q$,onUpdateExceptionField:v.OZ,onUpdateLogicCombo:v.Nc,onRemoveGroupField:v.I5,onChangeCascadingValue:v.QL,toggleMenu:v.js,onExpandAttributeFilterPanel:v.I},e),spatialFilterActions:(0,c.DE)({onChangeSpatialFilterValue:v.uo,onExpandSpatialFilterPanel:v.ku,onSelectSpatialMethod:v.HT,onSelectViewportSpatialMethod:v.lg,onSelectSpatialOperation:v.VF,onChangeDrawingStatus:y.Yf,onRemoveSpatialSelection:v.Ry,onShowSpatialSelectionDetails:v.ZH,onChangeDwithinValue:v.AQ,zoneFilter:v.eJ,zoneSearch:v.uM,zoneChange:v.uP},e),queryToolbarActions:(0,c.DE)({onQuery:v.yC,onReset:Yr,onSaveFilter:b.no,onRestoreFilter:b.Nd,storeAppliedFilter:b.Rb,onChangeDrawingStatus:y.Yf},e),crossLayerFilterActions:(0,c.DE)({expandCrossLayerFilterPanel:v.EU,setCrossLayerFilterParameter:v.IV,addCrossLayerFilterField:v.N5,updateCrossLayerFilterField:v.bn,removeCrossLayerFilterField:v.Bm,resetCrossLayerFilter:v.F2},e),controlActions:(0,c.DE)({onToggleQuery:d.Xi.bind(null,"queryPanel",null)},e)}}))(Yt),Kr=(0,f.P1)([function(e){return e.controls&&e.controls.toolbar&&"toc"===e.controls.toolbar.active},fr.Bt,function(e){return e.layers&&e.layers.settings||{expanded:!1,options:{opacity:1}}},function(e){return e.controls&&e.controls.queryPanel&&e.controls.queryPanel.enabled||!1},function(e){return(0,Br.ic)(e,{height:!0})},kr.Wy,sr.Vc,sr.hI,function(e){return e&&e.query&&e.query.isLayerFilter},fr.P_],(function(e,t,r,o,n,a,i,l,s,p){return{enabled:e,groups:t,settings:r,querypanelEnabled:o,layout:a?{}:n,appliedFilter:i,storedFilter:l,advancedToolbar:s,loadingError:p}})),eo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ur(e,t)}(l,e);var t,r,o,a,i=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Qr(o);if(a){var r=Qr(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Wr(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),$r(zr(t=i.call(this,e)),"getNoBackgroundLayers",(function(e){return"background"!==e.name})),$r(zr(t),"renderSidebar",(function(){return s().createElement(u.Z,{open:t.props.querypanelEnabled,sidebar:t.renderQueryPanel(),sidebarClassName:"query-form-panel-container",touch:!1,styles:{sidebar:Xr(Xr({},t.props.layout),{},{zIndex:1024,width:600}),overlay:{zIndex:1023,width:0},root:{right:t.props.querypanelEnabled?0:"auto",width:"0",overflow:"visible"},content:{overflowY:"auto"}}},s().createElement("div",null))})),$r(zr(t),"onToggle",(function(){t.props.advancedToolbar&&!n()(t.props.appliedFilter,t.props.storedFilter)?t.setState((function(){return{showModal:!0}})):t.props.onToggleQuery()})),$r(zr(t),"restoreAndClose",(function(){t.setState((function(){return{showModal:!1}})),t.props.onRestoreFilter(),t.props.onToggleQuery()})),$r(zr(t),"storeAndClose",(function(){t.setState((function(){return{showModal:!1}})),t.props.onSaveFilter(),t.props.onToggleQuery()})),$r(zr(t),"renderQueryPanel",(function(){return s().createElement("div",{className:"mapstore-query-builder"},s().createElement(Jr,{header:s().createElement(At,{loadingError:t.props.loadingError,onToggleQuery:t.onToggle}),spatialOperations:t.props.spatialOperations,spatialMethodOptions:t.props.spatialMethodOptions,toolsOptions:t.props.toolsOptions,featureTypeErrorText:s().createElement(Zr.Z,{msgId:"layerProperties.featureTypeError"}),appliedFilter:t.props.appliedFilter,storedFilter:t.props.storedFilter,advancedToolbar:t.props.advancedToolbar,loadingError:t.props.loadingError}),s().createElement(Jt.Z,null,s().createElement(Kt.Z,{fade:!0,show:t.state.showModal,title:s().createElement(Zr.Z,{msgId:"queryform.changedFilter"}),size:"xs",onClose:function(){return t.setState((function(){return{showModal:!1}}))},buttons:[{bsStyle:"primary",text:s().createElement(Zr.Z,{msgId:"yes"}),onClick:t.storeAndClose},{bsStyle:"primary",text:s().createElement(Zr.Z,{msgId:"no"}),onClick:t.restoreAndClose}]},s().createElement("div",{className:"ms-alert"},s().createElement("div",{className:"ms-alert-center"},s().createElement(Zr.Z,{msgId:t.props.loadingError?"queryform.changedFilterWithErrorAlert":"queryform.changedFilterAlert"}))))))})),t.state={showModal:!1},t}return t=l,(r=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){!0===e.querypanelEnabled&&!1===this.props.querypanelEnabled&&this.props.onInit()}},{key:"render",value:function(){return this.renderSidebar()}}])&&Gr(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),l}(s().Component);$r(eo,"propTypes",{id:i().number,buttonContent:i().node,groups:i().array,settings:i().object,querypanelEnabled:i().bool,groupStyle:i().object,groupPropertiesChangeHandler:i().func,layerPropertiesChangeHandler:i().func,onToggleGroup:i().func,onToggleLayer:i().func,onToggleQuery:i().func,onZoomToExtent:i().func,retrieveLayerData:i().func,onSort:i().func,onInit:i().func,onSettings:i().func,hideSettings:i().func,updateSettings:i().func,updateNode:i().func,removeNode:i().func,activateRemoveLayer:i().bool,activateLegendTool:i().bool,activateZoomTool:i().bool,activateSettingsTool:i().bool,visibilityCheckType:i().string,settingsOptions:i().object,layout:i().object,toolsOptions:i().object,appliedFilter:i().object,storedFilter:i().object,advancedToolbar:i().bool,onSaveFilter:i().func,onRestoreFilter:i().func}),$r(eo,"defaultProps",{groupPropertiesChangeHandler:function(){},layerPropertiesChangeHandler:function(){},retrieveLayerData:function(){},onToggleGroup:function(){},onToggleLayer:function(){},onToggleQuery:function(){},onZoomToExtent:function(){},onSettings:function(){},onInit:function(){},updateNode:function(){},removeNode:function(){},activateLegendTool:!0,activateZoomTool:!0,activateSettingsTool:!0,activateRemoveLayer:!0,visibilityCheckType:"checkbox",settingsOptions:{},querypanelEnabled:!1,layout:{},toolsOptions:{},onSaveFilter:function(){},onRestoreFilter:function(){}});const to={QueryPanelPlugin:(0,p.connect)(Kr,{groupPropertiesChangeHandler:g.WO,layerPropertiesChangeHandler:g.He,retrieveLayerData:m.k,onToggleGroup:(0,Ar.$0)("groups",g.bh),onToggleLayer:(0,Ar.$0)("layers",g.bh),onToggleQuery:d.Xi.bind(null,"queryPanel",null),onSort:(0,Ar.dD)(Ar.lD,g.MK),onSettings:g.RP,onInit:F.Xc,onZoomToExtent:h.Px,hideSettings:g.sF,updateSettings:g.VP,updateNode:g.tV,removeNode:g.ZF,onSaveFilter:b.no,onRestoreFilter:b.Nd})(eo),reducers:{queryform:Rr.Z,query:Mr.Z,layerFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_r,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b.y6:return Ir(Ir({},_r),{},{persisted:t.filter,applied:t.filter});case b.H1:return Ir(Ir({},e),{},{applied:e.persisted});case b.g$:return Ir(Ir({},e),{},{applied:t.filter});case b.Xk:return Ir(Ir({},e),{},{persisted:e.applied});case v.Eg:return Ir(Ir({},e),{},{applied:void 0});default:return e}}},epics:Xr(Xr(Xr({featureTypeSelectedEpic:function(e,t){return e.ofType(F.S0).filter((function(e){return e.url&&e.typeName})).switchMap((function(e){var r=t.getState();if((0,lr.hk)(r,e.typeName)){var o=Nr((0,lr.qj)(r,e.typeName)),n=o.geometry[0]&&o.geometry[0].attribute?o.geometry[0].attribute:"the_geom";return G().Observable.of((0,v.DD)(n))}return G().Observable.defer((function(){return or().get(ir.ZP.filterUrlParams(e.url,(0,pr.kS)(t.getState()))+"?service=WFS&version=1.1.0&request=DescribeFeatureType&typeName="+e.typeName+"&outputFormat=application/json")})).map((function(t){if("object"===qr(t.data)&&t.data.featureTypes&&t.data.featureTypes[0]){var r=Nr(t.data),o=r.geometry[0]&&r.geometry[0].attribute?r.geometry[0].attribute:"the_geom";return G().Observable.from([(0,v.DD)(o),(0,F.rG)(e.typeName,r)])}try{JSON.parse(t.data)}catch(t){return G().Observable.from([(0,F.t3)(e.typeName,"Error from WFS: "+t.message),nr.vU({title:"warning",message:"layerProperties.featureTypeErrorInvalidJSON",autoDismiss:3,position:"tc"})])}return G().Observable.from([(0,F.t3)(e.typeName,"Error: feature types are empty")])})).mergeAll().catch((function(t){return G().Observable.of((0,F.t3)(e.typeName,t.message||t.statusText))}))}))},wfsQueryEpic:function(e,t){return e.ofType(F.Qq).switchMap((function(r){var o,n,a,i=(n=(a=t.getState()).query&&a.query.featureTypes&&a.query.featureTypes[a.query.typeName]&&a.query.featureTypes[a.query.typeName].attributes&&a.query.featureTypes[a.query.typeName].attributes[0]&&a.query.featureTypes[a.query.typeName].attributes[0].attribute||null)?{sortBy:n,sortOrder:"A"}:{},l=(null==r||null===(o=r.filterObj)||void 0===o?void 0:o.sortOptions)||i,s=lr.b0.totalFeatures(t.getState()),p=ir.ZP.filterUrlParams(r.searchUrl,(0,pr.kS)(t.getState())),u=(0,fr.Iz)(t.getState())||{},c=u.layerFilter,f=u.params,d=Z()(Object.keys(f||{}),(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"cql_filter"===e.toLowerCase()})),y=(0,oe.mergeFiltersToOGC)({ogcVersion:"1.1.0"},d,c,r.filterObj),m=function(e,t,r){var o=(0,Er.u$)(r),n=(0,wr.jo)({id:o},"time")(r),a=(0,fr.CA)(r,o)||{},i=B()(a,'params["time"]');if((0,Er.DK)(r)&&n&&i){var l=(0,Or.parse)(e)||{};return{url:(0,Or.format)(Sr(Sr({},l),{},{query:Sr(Sr({},l.query),{},{time:i})})),options:t}}return{url:e,options:t}}(p,r.queryOptions||{},t.getState()),b=m.url,g=m.options,h=xr(xr({},r.filterObj.pagination),{},{totalFeatures:s,sortOptions:l},g);return G().Observable.merge((0,U.Mc)(xr(xr({},u),{},{name:r.filterObj.featureTypeName||u.name,search:xr(xr({},u.search),{},{url:b})}),y,h).map((function(e){return(0,F.w_)(e,r.searchUrl,r.filterObj,r.queryOptions,r.reason)})).catch((function(e){return G().Observable.of((0,F.Lm)(e))})).startWith((0,F.Fs)(!0)).concat(G().Observable.of((0,F.Fs)(!1)))).takeUntil(e.ofType(F.VN))}))},viewportSelectedEpic:function(e,t){return e.ofType(v.On,h.pP).switchMap((function(e){var r=e.type===h.pP?e:(0,Fr.Od)(t.getState());if((e.type===v.On||e.type===h.pP&&"Viewport"===(0,sr.BU)(t.getState()))&&r.bbox&&r.bbox.bounds&&r.bbox.crs){var o=Object.keys(r.bbox.bounds).reduce((function(e,t){return at()({},e,Tr({},t,parseFloat(r.bbox.bounds[t])))}),{});return G().Observable.of((0,v.ds)(it.default.getViewportGeometry(o,r.bbox.crs)))}return G().Observable.empty()}))},redrawSpatialFilterEpic:function(e,t){return e.ofType(F.R1).switchMap((function(){var e=t.getState(),r=(0,sr.vE)(e),o={type:"Feature",geometry:{type:(0,sr.a8)(e),coordinates:(0,sr.G$)(e)}},n=(0,sr.Nl)(e)?(0,y.Yf)("drawOrEdit",r.method||"","queryform",[o],{featureProjection:(0,sr.IM)(e),drawEnabled:!1,editEnabled:!1}):(0,y.Yf)("clean",r.method||"","queryform",[],{drawEnabled:!1,editEnabled:!1});return G().Observable.of(n)}))}},ur),vr),br)}},81756:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var o=r(71703),n=r(5346);const a=(0,o.connect)((function(e){return{locale:e.locale&&e.locale.currentLocale,messages:e.locale&&e.locale.messages||[]}}))(n.Z)},88113:(e,t,r)=>{"use strict";r.d(t,{b6:()=>d,PG:()=>y,_x:()=>m,Mm:()=>b,dP:()=>g,SX:()=>h,ZL:()=>v,_S:()=>F,iH:()=>O,R7:()=>E,Q7:()=>w,n7:()=>P,bA:()=>S,hm:()=>j,E2:()=>C,Cb:()=>x,eK:()=>T,Im:()=>q,e8:()=>N,$t:()=>D,kS:()=>I,y:()=>L,l2:()=>_,HN:()=>M,BM:()=>R,am:()=>k,LV:()=>B,CK:()=>A});var o=r(22222),n=r(27361),a=r.n(n),i=r(78718),l=r.n(i),s=r(827),p=r(76712);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){f(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d=function(e){return a()(e,"catalog.services")},y=(0,o.P1)((function(e){return a()(e,"catalog.default.staticServices")}),d,(function(e,t){return c(c({},t),l()(e,"default_map_backgrounds"))})),m=function(e){return a()(e,"catalog.default.tileSizes",[256,512])},b=function(e){return a()(e,"controls.metadataexplorer.group")},g=function(e){return a()(e,"catalog.saving")},h=function(e){return a()(e,"catalog.result")},v=function(e){return a()(e,"catalog.openCatalogServiceList")},F=function(e){return a()(e,"catalog.newService")},O=function(e){return a()(e,"catalog.newService.type","csw")},E=function(e){return a()(e,'catalog.services["'.concat(a()(e,"catalog.selectedService"),'"]'))},w=function(e){return a()(e,'catalog.services["'.concat(a()(e,"catalog.selectedService"),'"].type'),function(e){return a()(e,'catalog.default.staticServices["'.concat(a()(e,"catalog.selectedService"),'"].type'),"csw")}(e))},P=function(e){return a()(e,'catalog.services["'.concat(a()(e,"catalog.selectedService"),'"].layerOptions'),{})},S=function(e){return a()(e,"catalog.searchOptions")},j=function(e){return a()(e,"catalog.loadingError")},C=function(e){return a()(e,"catalog.loading",!1)},x=function(e){return a()(e,"catalog.selectedService")},T=function(e){return a()(e,"catalog.mode","view")},q=function(e){return a()(e,"catalog.layerError")},N=function(e){return a()(e,"catalog.searchOptions.text","")},D=function(e){return"metadataexplorer"===a()(e,"controls.toolbar.active")||a()(e,"controls.metadataexplorer.enabled")},I=function(e){return(a()(e,"localConfig.authenticationRules")||[]).filter((function(e){return"authkey"===e.method})).map((function(e){return e.authkeyParamName}))||[]},L=function(e){return a()(e,"catalog.pageSize",4)},_=function(e){return a()(e,"catalog.delayAutoSearch",1e3)},M=(0,o.zB)({projection:s.uy}),R=function(e){return a()(e,"catalog.formatsLoading",!1)},k=function(e){return a()(e,"catalog.newService.supportedFormats.imageFormats",p.QQ)},B=function(e){return a()(e,"catalog.newService.supportedFormats.infoFormats",(0,p.B8)())},A=function(e){return a()(e,"catalog.newService.formatUrlUsed","")}},67306:(e,t,r)=>{"use strict";r.d(t,{Wy:()=>a,i$:()=>i,P0:()=>l});var o=r(22222),n=r(24684),a=function(e){return e&&e.dashboard&&e.dashboard.editor&&e.dashboard.editor.available},i=function(e){return e&&e.dashboard&&e.dashboard.editing},l=function(e){return e&&e.dashboard&&e.dashboard.showConnections};(0,o.P1)(n.F,(function(e){return e&&e.dashboard&&e.dashboard.resource}),(function(e){return e&&e.browser&&e.browser.mobile}),(function(e,t,r){return r?!r:t&&t.canEdit||isNaN(e.substr(-4))}))},24684:(e,t,r)=>{"use strict";r.d(t,{F:()=>a,y:()=>i});var o=r(27361),n=r.n(o),a=function(e){return n()(e,"router.location.pathname")||"/"},i=function(e){return n()(e,"router.location.search")||""}},28492:(e,t,r)=>{(e.exports=r(9252)()).push([e.id,"",""])},65207:(e,t,r)=>{var o=r(28492);"string"==typeof o&&(o=[[e.id,o,""]]),r(14246)(o,{}),o.locals&&(e.exports=o.locals)}}]);